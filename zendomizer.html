<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link rel="icon" type="image/png" href="assets/ZENdomizer_favicon.png">
<title>ZENDOMIZER v2.7 | Vehicle list 06/2024</title>
<style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .lang-button.active {
      outline: 2px solid #00E5FF;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    #grandraceTicker {
      width: 100%;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.85);
      color: #FF00FF;
      font-size: 20px;
      font-weight: bold;
      text-align: left; /* Achtung: nicht center! */
      position: relative;
      white-space: nowrap;
      border-top: 2px solid #FF00FF;
      border-bottom: 2px solid #FF00FF;
      padding: 12px 0;
    }
    
    #grandraceContent {
      display: inline-block;
      padding-left: 100%; /* Start au√üerhalb */
      animation: scrollMarquee 30s linear infinite;
      white-space: nowrap;
    }
    
    @keyframes scrollMarquee {
      0% { transform: translateX(0%); }   /* - Start weiter nach links statt -18*/
      100% { transform: translateX(-100%); } /* - Ende weiter nach links statt  -67 */
    }


    .toast {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #222;
      color: #0f0;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease-in-out;
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }
    .control-panel {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 12px;
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .filter-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px 16px;
      align-items: center;
      background: transparent;
      padding: 16px;
      border-radius: 12px;
      box-sizing: border-box;
    }
    .filter-wrapper {
      display: flex;
      align-items: stretch;
      gap: 16px;
      padding: 0;         /* Kein horizontaler Innenabstand */
      width: 100%;        /* Wichtig f√ºr volle Breite */
      justify-content: center;
      box-sizing: border-box;
    } 
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      justify-items: center;
      width: 100%;
      max-width: 420px; /* 2 Spalten √† 120px + 1x gap (18px) + 18(test)*/
      margin-bottom: 10px;
    }
    .reset-row {
      display: flex;
      justify-content: flex-end;
      padding: 0 16px;
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 0px;     /* üü¢ h√∂her schieben */
      margin-bottom: 0px;  /* optional: Luft unten */
    }
    /* === NEON-GRUNDSTIL KACHEL === */
    /* === Neon-Badge oben links === */
    .order-badge {
      position: absolute;
      top: 0;
      right: 20px; /* statt right: 4 */
      height: 100%;
      width: 32px; /* etwas breiter statt 24 */
      font-size: 120px;
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: multiply;
      opacity: 0.45;
      color: currentColor;
      text-shadow: /* statt 0 0 2px #000, 0 0 4px #000;*/
          0 0 4px #000,
          0 0 6px currentColor,
          0 0 12px currentColor,
          0 0 18px currentColor,
          0 0 22px currentColor;
    }
    /* Farbvarianten passend zur Kategorie */
    .cat-yellow .order-badge {
      color: #FFD700;
    }
    .cat-blue .order-badge {
      color: #00E5FF;
    }
    .cat-orange .order-badge {
      color: #FF9900;
    }
    .cat-magenta .order-badge {
      color: #FF3377;
    }
    
    /* Zus√§tzlich: Textfarbe in Kacheln = Rahmenfarbe */
    .catLabel.cat-yellow { color: #FFD700; }
    .catLabel.cat-blue   { color: #00E5FF; }
    .catLabel.cat-orange { color: #FF9900; }
    .catLabel.cat-magenta{ color: #FF3377; }
    .catLabel.cat-green  { color: #39ff14; }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      justify-items: center;
      align-items: center;
      max-width: 396px;
    }
    
    .catWrapper {
      position: relative;
      display: block;      /* oder flex */
      width: 120px;
      height: 120px;
    }    
    .catCheckbox {
      display: none;
    }
    .catLabel {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid transparent;
      border-radius: 12px;
      width: 120px;
      height: 120px;
      color: #fff;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      box-sizing: border-box;
      text-shadow: 0 0 2px #000;
      cursor: pointer;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
      position: relative;
      z-index: 2; /* Wichtig: Text liegt √ºber der Badge */
    }
    /* Text in Kategorie Button zentriet (wegen Mehrzeilig) */
    .catLabel span {
      text-align: center;
      line-height: 1.2;
    }
    /* Text lecuhtet wenn Kategorie ausgew√§hlt */
    .catCheckbox:checked + .catLabel {
      box-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor,
        0 0 20px currentColor,
        0 0 28px currentColor;
      animation: none;
    }
    .catCheckbox:checked + .catLabel span {
  color: currentColor;
  font-weight: bold;
  text-shadow:
    0 0 1px currentColor,
    0 0 2px currentColor,
    0 0 4px currentColor;
}
    /* === Neon-Kategorien === */
    
    /* GELB */
    .catLabel.cat-yellow {
      border-color: #FFD700;
      color: #FFD700;
    }
    /* BLAU */
    .catLabel.cat-blue {
      border-color: #00E5FF;
      color: #00E5FF;
    }
    /* ORANGE */
    .catLabel.cat-orange {
      border-color: #FF9900;
      color: #FF9900;
    }
    /* MAGENTA */
    .catLabel.cat-magenta {
      border-color: #FF3377;
      color: #FF3377;
    }
    /* GR√úN */
    .catLabel.cat-green {
      border-color: #39ff14;
      color: #39ff14;
    }
    /* RESET-Button im Grid */
    .reset-special {
      background: linear-gradient(135deg, #FF4444 0%, #CC0000 100%); /* Eigenes kr√§ftiges Rot-Gradient */
      border: 2px solid #FF4444;
      color: #000000; /* Schwarze Schrift */
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    /* Hover Effekt */
    .reset-special:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #FF4444, 0 0 24px #FF4444;
    }

    /* Klick Effekt */
    .reset-special:active {
      transform: scale(0.95);
      box-shadow: 0 0 6px #FF4444 inset;
    }

    /* Button-Reset f√ºr HTML-Button-Tag */
    button.reset-special {
      appearance: none;
      border: none;
    }
    @keyframes pulse-neon {
      0%, 100% {
        box-shadow: 0 0 6px currentColor;
        text-shadow: 0 0 2px currentColor;
      }
      50% {
        box-shadow: 0 0 12px currentColor, 0 0 18px currentColor; /* statt 0 0 24px currentColor */
        text-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
      }
    }
    @keyframes pulse-text {
      0%, 100% {
        text-shadow: 0 0 2px currentColor;
      }
      50% {
        text-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
      }
    }
    .category-grid:not(.limit-reached) .catLabel:hover {
      animation: pulse-neon 1.2s infinite;
      border-color: currentColor;
    }
    .category-grid:not(.limit-reached) .catLabel:hover span {
      animation: pulse-text 1.2s infinite;
    }
    .results-panel {
      margin-top: 8px;
      margin-bottom: 32px; /*statt 64px*/
      width: 100%;
      max-width: 100%; /* wichtig: kein limitierendes max-width */
      display: flex;   /* ‚Üê statt block */
      flex-direction: column;
      align-items: center; /* ‚Üê zentriert den inneren #results Block */
    } 
    #results {
      width: 396px;             /* exakt wie eine Slotbox */
      display: flex;            /* statt grid */
      flex-direction: column;
      gap: 24px;
      margin: 0 auto;
    }
        .vehicle {
      background: #111;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px 14px;
      margin-bottom: 10px;
    }
    /* GO-Button (gro√ü & gr√ºn) */
    .start-btn {
      background: linear-gradient(135deg, #39ff14 0%, #0a3d00 100%); /* kr√§ftiges Gr√ºn */
      border: 2px solid #39ff14;
      color: black;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 12px; /* leicht abgerundet, wie Reset */
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 180px; /* Gr√∂√üe wie Reset-Kachel */
      height: 80px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box;
    }
    
    /* Hover-Effekt */
    .start-btn:not(.inactive):hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #39ff14, 0 0 24px #39ff14;
    }
    
        /* Klick-Effekt */
    .start-btn.clicked {
      transform: scale(0.95);
      box-shadow: 0 0 6px #39ff14 inset;
    }
    
    #copyNotice {
      color: lime;
      margin-top: 10px;
      display: none;
      font-weight: bold;
    }
.layout {
  display: flex;
  gap: 32px;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
  max-width: 2000px;
  margin: 0 auto;
  padding-top: 20px; /* statt 90 */
  position: relative;
  z-index: 1;
}

.left-panel,
.right-panel {
  flex: 1 1 40%;
  min-width: 240px;
  max-width: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 0;
  margin: 0;
}
.right-panel {
  position: relative;
}
.center-panel {
  flex: 0 0 20%;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.machine-wrapper {
  position: relative;
  width: 100%;
  max-width: 720px;      /* oder 960px, wie du magst */
  aspect-ratio: 1 / 1;   /* Quadrat */
  margin: 0 auto;
}

.button-top {
  display: flex;
  justify-content: center;
  align-items: flex-end; /* ‚Üê Diese Zeile kommt NEU dazu */
  gap: 24px;
  margin-bottom: 8px;
}
.filter-control {
  background-color: rgba(0, 0, 0, 0.6);
  color: #39ff14;
  border: 2px solid #39ff14;
  border-radius: 12px;
  font-weight: bold;
  font-size: 16px;
  height: 60px;
  padding: 12px 16px;
  box-sizing: border-box;
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
  text-align: left;
  width: 100%;
  max-width: 180px;
}
.filter-control:hover {
  animation: pulse-neon 1.2s infinite;
  border-color: #39ff14;
  color: #39ff14;
  background-color: rgba(0, 0, 0, 0.6); /* gleich wie Grundfarbe */
}
/* Aktiv (‚â† Standardwert) */
.filter-control.active {
  box-shadow:
    0 0 6px #39ff14,
    0 0 12px #39ff14,
    0 0 20px #39ff14;
  color: #39ff14;
  font-weight: bold;
  text-shadow:
    0 0 2px #39ff14,
    0 0 4px #39ff14,
    0 0 8px #39ff14;
}
.filter-control.bike-active {
  box-shadow:
    0 0 6px #39ff14,
    0 0 12px #39ff14,
    0 0 20px #39ff14;
  border-color: #39ff14;
  color: #39ff14;
  font-weight: bold;
  text-shadow:
    0 0 2px #39ff14,
    0 0 4px #39ff14,
    0 0 8px #39ff14;
}
select.filter-control {
  appearance: none;
  background-image: url("data:image/svg+xml;utf8,<svg fill='%23aaa' viewBox='0 0 140 140' xmlns='http://www.w3.org/2000/svg'><polygon points='70,100 100,40 40,40'/></svg>");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 10px;
  padding-right: 32px;
}
@media (max-width: 1068px) {
  .layout {
    flex-direction: column;
    align-items: stretch;
  }

  .left-panel,
  .center-panel,
  .right-panel {
    max-width: 100%;
    flex: none;
  }

  .button-top {
    justify-content: center;
  }
}
@media (min-width: 1069px) {
  .center-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;   /* Buttons nach unten dr√ºcken */
    min-height: 600px; ;         /* passend zur Automatenh√∂he POLD:height: 600px;*/
  }

  .button-top {
    margin-top: auto;
    margin-bottom: -80px;         /* Button Abstand vom unteren Rand statt 42*/
  }
}
/* --- SLOTBOXEN (rechter Bereich) --- */
.slot-box {
  width: 372px; /* width + 2* padding (12) + 2* boarder (8) = Geasmtbreite || statt 396px*/
  height: 120px;
  padding: 12px;
  border: 3px solid currentColor;
  position: relative;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 16px;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
  color: currentColor;
  box-shadow: 0 0 12px currentColor;
  transition: all 0.3s ease-in-out;
  display: grid;
  grid-template-rows: 24px 80px 18px; /* ‚Üê definierte H√∂hen */
  align-items: center;
  justify-items: center;
  animation: pulse-neon 2s infinite;
}
.slot-category {
  font-size: 16px;
  font-weight: bold;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.slot-name {
  font-size: 20px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  text-align: center;
  word-break: break-word;
}
.slot-box.empty .slot-name {
  font-size: 80px;
  animation: spin3D 1.6s linear infinite, pulse-text 1.2s infinite;
  transform-style: preserve-3d;
  backface-visibility: hidden;
}
.question-mark {
  text-shadow:
    0 0 2px currentColor,
    0 0 6px currentColor,
    0 0 12px currentColor;
}
.slot-box.empty .question-mark {
  font-size: 80px;
  animation: pulse-text 1.2s infinite;
  line-height: 1;
}
.slot-box .question-mark {
  font-size: 80px;
  animation: spin3D 1.6s linear infinite, pulse-text 1.2s infinite;
  line-height: 1;
  transform-style: preserve-3d;
  backface-visibility: hidden;
}
.slot-box.empty {
  perspective: 600px;
}
@keyframes spin3D {
  from { transform: rotateY(0deg); }
  to { transform: rotateY(360deg); }
}
.slot-warning {
  font-size: 12px;
  opacity: 0.4;
  color: rgba(255, 255, 255, 0.4);
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  justify-content: center;
}
.slot-warning:empty::before {
  content: none;
}
.slot-badge {
  position: absolute;
  right: 28px;
  top: 0;
  height: 100%;
  width: 46px;
  font-size: 180px;
  font-weight: 900;
  color: currentColor;
  display: flex;
  align-items: center;
  justify-content: center;
  text-shadow:
    0 0 4px #000,
    0 0 6px currentColor,
    0 0 12px currentColor,
    0 0 20px currentColor;
  opacity: 0.4;
  pointer-events: none;
  mix-blend-mode: screen;
}
.slot-standby {
  color: #660066; /* noch dunkler: tiefes dunkelpink/viot */
  border-color: #660066;
  box-shadow: 0 0 2px #660066;
  background: rgba(0, 0, 0, 0.7); /* etwas dunklerer Hintergrund */
  animation: pulse-neon-standby 3s infinite; /* neue sanfte Animation */
}
.slot-standby .slot-name {
  font-size: 80px;
  animation: spin3D 1.6s linear infinite, pulse-text 1.2s infinite;
}
.slot-standby .question-mark {
  color: #660066;
  text-shadow: 0 0 1px #660066, 0 0 2px #660066;
}
@keyframes pulse-neon-standby {
  0%, 100% {
    box-shadow: 0 0 2px #660066;
    text-shadow: 0 0 1px #660066;
  }
  50% {
    box-shadow: 0 0 4px #660066;
    text-shadow: 0 0 2px #660066;
  }
}

.slot-standby .slot-badge {
  color: #3d2233;         /* dunkler, matter Viotton statt pink #993366*/
  text-shadow: none;      /* kein Leuchteffekt */
  opacity: 0.4;           /* leicht transparent f√ºr den ‚Äûaus‚Äú-Effekt */
}
.your-pick-title {
  font-size: 36px;
  margin: 0 0 16px 0;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
  transition: all 0.4s ease-in-out;
  letter-spacing: 1px;
  max-width: 396px;
  margin-left: auto;
  margin-right: auto;
}
.your-pick-title.standby {
  color: #FF00FF;
  opacity: 1;
  text-shadow:
    0 0 4px #000,
    0 0 8px #111,
    0 0 12px #FF00FF;
}
.your-pick-title.active {
  color: #FF00FF;
  opacity: 1;
  text-shadow:
    0 0 2px #FF00FF,
    0 0 6px #FF00FF,
    0 0 12px #FF00FF,
    0 0 20px #FF00FF;
  animation: pickPulse 2s infinite;
}

@keyframes pickPulse {
  0%, 100% {
    text-shadow:
      0 0 2px #FF00FF,
      0 0 6px #FF00FF,
      0 0 12px #FF00FF,
      0 0 20px #FF00FF;
  }
  50% {
    text-shadow:
      0 0 6px #FF00FF,
      0 0 12px #FF00FF,
      0 0 20px #FF00FF,
      0 0 28px #FF00FF;
  }
}
/* Farbliche Kategorien f√ºr Slot-Boxen */
.slot-yellow { color: #FFD700; } /* Gelb f√ºr Street/Drift/Hypercar */
.slot-blue   { color: #00E5FF; } /* Blau f√ºr Racing/AGP */
.slot-orange { color: #FF9900; } /* Orange f√ºr Rally-Gruppen */
.slot-magenta { color: #FF3377; } /* R√∂tliches Magenta f√ºr Monster Truck */

.start-btn.inactive {
  color: #144914;
  border-color: #144914;
  opacity: 0.4;
  animation: none;
  cursor: default;
}
.start-btn.pulsing {
  color: #39ff14;
  border-color: #39ff14;
  opacity: 1;
  animation: pulse-neon 1.2s infinite;
  cursor: pointer;
}
@keyframes slotFlash {
  0%   { box-shadow: 0 0 16px currentColor, 0 0 24px currentColor; transform: scale(1.02); }
  50%  { box-shadow: 0 0 10px currentColor, 0 0 18px currentColor; transform: scale(1.01); }
  100% { box-shadow: 0 0 8px currentColor; transform: scale(1); }
}

.slot-box.flash {
  animation: slotFlash 0.4s ease;
}

.pulse-glow {
  color: #00E5FF;
  text-shadow:
    0 0 6px #00E5FF,
    0 0 12px #00E5FF,
    0 0 18px #00E5FF;
  animation: glowPulse 2s infinite;
}

@keyframes glowPulse {
  0%, 100% {
    text-shadow:
      0 0 6px #00E5FF,
      0 0 12px #00E5FF,
      0 0 18px #00E5FF;
  }
  50% {
    text-shadow:
      0 0 12px #00E5FF,
      0 0 18px #00E5FF,
      0 0 30px #00E5FF;
  }
}

#machineLayer {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 720px;
  max-width: 90vw;
  z-index: 0;
  pointer-events: none;
}

#machineBackground {
  position: relative; /* wichtig, damit z-index greift */
  width: 100%;
  height: auto;
  display: block;
  z-index: 1;
}

#wheelOverlay {
  position: absolute;
  top: 89px;
  left: 50%;
  transform: translateX(-50%);
  width: 427px;
  height: 427px;
  z-index: 0;
  pointer-events: none;
  transform-origin: center center;
}

#wheelOverlay.spin {
  animation: spinWheel var(--spin-duration) ease-in-out;
}

@keyframes spinWheel {
  0% { transform: translateX(-50%) rotate(0deg); }
  100% { transform: translateX(-50%) rotate(1080deg); }
}
    
</style>
</head>
<body>
<div id="machineLayer">
  <img src="assets/pic/ZENDOMIZER_wheel.png" id="wheelOverlay" />
  <img src="assets/pic/ZENDOMIZER_slotmachine.png" id="machineBackground" />
</div>

<div class="layout"><div class="left-panel">
    <div class="filter-wrapper">
        <div class="filter-grid">
            <button id="bikeFilterBtn" class="filter-control" onclick="toggleBikeFilter()">loading...</button>
            <select id="countrySelect" class="filter-control" onchange="updateFilterHighlighting()">
                <option value=""></option> <!-- Text wird per JS gesetzt: t("filter_country") -->
            </select>
            <select id="brandSelect" class="filter-control" onchange="updateFilterHighlighting()">
                <option value=""></option> <!-- Text wird per JS gesetzt: t("filter_brand") -->
            </select>
            <select id="eraSelect" class="filter-control" onchange="updateFilterHighlighting()">
                <option value=""></option> <!-- Text wird per JS gesetzt: t("filter_era") -->
            </select>
        </div>
    </div>
    <div class="category-grid">
      <!-- Reihe 1 -->
      <div class="catWrapper">
          <input type="checkbox" id="cat1" class="catCheckbox" onchange="handleCategoryClick(this)" value="Street Tier 1"/>
          <label for="cat1" class="catLabel cat-yellow"><span>Street<br>Tier 1</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat2" class="catCheckbox" onchange="handleCategoryClick(this)" value="Street Tier 2"/>
          <label for="cat2" class="catLabel cat-yellow"><span>Street<br>Tier 2</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat8" class="catCheckbox" onchange="handleCategoryClick(this)" value="Hypercar"/>
          <label for="cat8" class="catLabel cat-yellow"><span>Hypercar</span></label>
      </div>
    
      <!-- Reihe 2 -->
      <div class="catWrapper">
          <input type="checkbox" id="cat10" class="catCheckbox" onchange="handleCategoryClick(this)" value="Drift"/>
          <label for="cat10" class="catLabel cat-yellow"><span>Drift</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat3" class="catCheckbox" onchange="handleCategoryClick(this)" value="Racing"/>
          <label for="cat3" class="catLabel cat-blue"><span>Racing</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat4" class="catCheckbox" onchange="handleCategoryClick(this)" value="AGP"/>
          <label for="cat4" class="catLabel cat-blue"><span>AGP</span></label>
      </div>
    
      <!-- Reihe 3 -->
      <div class="catWrapper">
          <input type="checkbox" id="cat7" class="catCheckbox" onchange="handleCategoryClick(this)" value="Rally"/>
          <label for="cat7" class="catLabel cat-orange"><span>Rally</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat6" class="catCheckbox" onchange="handleCategoryClick(this)" value="Rally Raid"/>
          <label for="cat6" class="catLabel cat-orange"><span>Rally Raid</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="cat9" class="catCheckbox" onchange="handleCategoryClick(this)" value="Monster Truck"/>
          <label for="cat9" class="catLabel cat-magenta"><span>Monster Truck</span></label>
      </div>
    
      <!-- Reihe 4 -->
      <div class="catWrapper">
          <input type="checkbox" id="cat5" class="catCheckbox" onchange="handleCategoryClick(this)" value="Motocross"/>
          <label for="cat5" class="catLabel cat-orange"><span>Motocross</span></label>
      </div>
      <div class="catWrapper">
          <input type="checkbox" id="catGR" class="catCheckbox"/>
          <label for="catGR" class="catLabel cat-green"><span>Grandrace<br>Categories</span></label>
      </div>
      <div class="catWrapper">
        <button id="resetBtnGrid" class="catLabel cat-reset reset-special" onclick="resetSmart()"><span>RESET</span></button>
      </div>
    </div>        
</div>
    <div class="center-panel">
        <div class="button-top">
            <button id="goBtn" class="start-btn" onclick="handleGo()">GO</button>
        </div>
    </div>
    <div class="right-panel">
      <div class="results-panel">
        <h2 id="yourPickTitle" class="your-pick-title standby">Your Pick</h2>
        <div id="results"></div>
      </div>
      <!-- Grandrace Ticker kommt JETZT hier in die rechte Spalte -->
      <div id="grandraceTicker" class="marquee">
        <div id="grandraceContent"></div>
      </div>
    </div> <!-- Ende right-panel -->
</div>
<script src="https://shogun160.github.io/TCM-ZEN_DOMIZER/cars/vehicles.json" type="application/json"></script>
<script>
  let currentLang = localStorage.getItem("zendomizerLang") || "de";
  let translations = {};
  let availableLanguages = [];
  let bikeFilterMode = "no_bike"; // ‚Üí "top_tier" ‚Üí "bike" ‚Üí "all" ‚Üí wieder "no_bike"

  function t(key, vars = {}) {
    let str = translations?.[currentLang]?.[key] || key;
    for (const [k, v] of Object.entries(vars)) {
      str = str.replaceAll(`{${k}}`, v);
    }
    return str;
  }
  // Mapping f√ºr Era-Werte
  const eraTranslationKeys = {
    "classic": "era_classic",
    "modern": "era_modern"
  };

  function translateEra(value) {
    const key = eraTranslationKeys[value?.toLowerCase()];
    return key ? t(key) : value;
  }

  function translateCountry(value) {
    const key = "country_" + (value || "").toLowerCase().replace(/\s+/g, "_");
    return t(key);
  }

  let vehicles = [];

  Promise.all([
    fetch("translations/i18n.json").then(res => res.json()),
    fetch("cars/vehicles.json").then(res => res.json())
  ])
  .then(([i18nData, vehicleData]) => {
    translations = i18nData;
    availableLanguages = Object.keys(i18nData.meta || {});
    vehicles = vehicleData;

    createLanguageSwitcher();
    applyTranslations();
    initializeDropdowns();
    updateSlotBoxes();
    updateResetButtonState();
    updateGoButtonState();
  })
  .catch(err => {
    console.error("‚ùå Fehler beim Laden der Daten:", err);
  });

  function createLanguageSwitcher() {
      const container = document.createElement("div");
      container.id = "langSwitcher";
      container.style.position = "absolute";
      container.style.top = "12px";
      container.style.right = "12px";
      container.style.zIndex = "500";
      container.style.display = "flex";
      container.style.gap = "12px";
    
      for (const lang of availableLanguages) {
        const meta = translations.meta[lang];
        const btn = document.createElement("button");
    
        // üñºÔ∏è Flaggenbild einf√ºgen
        const img = document.createElement("img");
        img.src = `translations/flags/${lang.toUpperCase()}.png`;
        img.alt = meta.label || lang;
        img.style.width = "36px";
        img.style.height = "24px";
        img.style.borderRadius = "4px";
        img.style.objectFit = "cover";
    
        btn.appendChild(img);
    
        btn.title = meta.label || lang;
        btn.classList.add("lang-button");
        if (lang === currentLang) {
          btn.classList.add("active");
        }
    
        btn.style.fontSize = "0"; // Text unterdr√ºcken
        btn.style.cursor = "pointer";
        btn.style.background = "transparent";
        btn.style.border = "none";
    
        btn.onclick = () => {
          currentLang = lang;
          localStorage.setItem("zendomizerLang", lang);
          applyTranslations();
          document.querySelectorAll(".lang-button").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        };
    
        container.appendChild(btn);
      }
    
      document.body.appendChild(container);
    }

  function rebuildEraDropdown() {
    const eraSelect = document.getElementById("eraSelect");
    if (!eraSelect) return;

    const selectedValue = eraSelect.value;
    const eraSet = new Set(vehicles.map(v => v.era));

    eraSelect.innerHTML = "";

    const empty = document.createElement("option");
    empty.value = "";
    empty.textContent = t("filter_era");
    eraSelect.appendChild(empty);

    [...eraSet].sort().forEach(era => {
      const option = document.createElement("option");
      option.value = era;
      option.textContent = translateEra(era);
      eraSelect.appendChild(option);
    });

    eraSelect.value = selectedValue;
  }

  function rebuildCountryDropdown() {
    const countrySelect = document.getElementById("countrySelect");
    if (!countrySelect) return;

    const selectedValue = countrySelect.value;
    const countrySet = new Set(vehicles.map(v => v.country));

    countrySelect.innerHTML = "";

    const empty = document.createElement("option");
    empty.value = "";
    empty.textContent = t("filter_country");
    countrySelect.appendChild(empty);

    [...countrySet].sort().forEach(country => {
      const option = document.createElement("option");
      option.value = country;
      option.textContent = t("country_" + (country || "").toLowerCase().replace(/\s+/g, "_")) || country;
      countrySelect.appendChild(option);
    });

    countrySelect.value = selectedValue;
  }


  function applyTranslations() {
    document.querySelector("#countrySelect option[value='']").textContent = t("filter_country");
    document.querySelector("#brandSelect option[value='']").textContent = t("filter_brand");
    document.querySelector("#eraSelect option[value='']").textContent = t("filter_era");

    const bfb = document.getElementById("bikeFilterBtn");
    if (bfb) {
      if (bikeFilterMode === "no_bike") {
        bfb.innerText = t("bike_no");
      } else if (bikeFilterMode === "top_tier") {
        bfb.innerText = t("top_tier");
      } else if (bikeFilterMode === "bike") {
        bfb.innerText = t("bike_yes");
      } else {
        bfb.innerText = t("bike_all");
      }
    }
    rebuildEraDropdown();
    rebuildCountryDropdown();
  }

    /*
     * BEGIN: Borrowed from https://github.com/calamity-inc/motorfe.st/
     */
    const ROTATION_START = 1741258200;
    const ROTATION = [
        ["Kahakuloa", "ST1 > Rally > ST2"],
        ["Kalaeloa", "AGP > Hyper > ST1"],
        ["Kenuku", "RR > Rally"], //Cat3 is also RR
        ["Manua Pele", "Racing > AGP > ST2", "Main Stage"],
        ["Diamond Head", "AGP > Rally > Racing"],
        ["Kaena Point", "ST1 > Motocross > RR"],
        ["Diamond Head", "Racing > Hyper > ST2"],
        ["Paia", "AGP > ST2 > Hyper", "Special Weather"],
        ["Kaneohe", "RR > ST1 > Racing"],
        ["Haleiwa", "Hyper > Racing > ST2"],
        ["Kealaloloa", "Drift > Racing > ST2"],
        ["Haleiwa", "Rally > ST2 > Racing", "No Colission"],
        ["Waikiki", "Racing > Hyper > ST2"],
        ["Wailea", "AGP > Hyper > Racing"],
        ["Kalaeloa", "Motocross > Rally/Plane > Drift"],
        ["Wahiawa Fields", "AGP > ST2 > Hyper", "No Collision"],
        ["Kahuku", "Racing > Rally > ST2"],
        ["Kealaloloa", "ST1 > RR > Hyper"],
        ["Nuuanu - Punchbowl", "Motocross > Monster > Rally"],
        ["Mauna Pele", "Monster > ST1 > Hyper", "Main Stage"],
        ["Ma'akua Black Beach", "Hyper > ST2 > AGP"],
        ["Wailea", "ST2 > Hyper > Racing"],
        ["Kula", "Racing > AGP > ST2"],
        ["Lahaina", "Hyper > ST2 > Hyper", "Special Weather"],
    ];
    const EVENT_DURATION = 20 * 60;
    const ROTATION_DURATION = ROTATION.length * EVENT_DURATION;

    function getCurrentEventIndex()
    {
        return ((((new Date() / 1000) - ROTATION_START) % ROTATION_DURATION) / EVENT_DURATION) | 0;
    }
    /*
     * END: Borrowed from https://github.com/calamity-inc/motorfe.st/
     */
    function getCurrentUTC()
    {
        let currentDate = new Date();
        let currentDay = currentDate.getDay()
        let currentMinutes = currentDate.getHours()*60 + currentDate.getMinutes();

        return [currentDay, currentMinutes]
    }

        // Format ist [ <Tag>,  <Minuten> ], Tage werden von 1 (Montag) bis 7 (Sonntag) durchnumeriert.
    // Die Zeiten unten m√ºssen angepasst werden.
    const GRDAY_START = [ 6, 9*60 ];  // Samstag, 9:00 Uhr UTC
    const GRDAY_STOP = [ 8, 9*60 ];   // Sonntag, 9:00 Uhr UTC

    function isGrandRaceDay() {
        let currentUtc = getCurrentUTC();

        return (GRDAY_START[0] < currentUtc[0] && currentUtc[0] < GRDAY_STOP[0]) ||     // Day in between, always the proper time
            (currentUtc[0] === GRDAY_START[0] && currentUtc[1] >= GRDAY_START[1]) ||    // Proper time of START day
            (currentUtc[0] === GRDAY_STOP[0] && currentUtc[1] <= GRDAY_STOP[1])         // Proper time on STOP day
    }

    /* Map rotation types to checkbox Ids */
    const ROTATION_MAP = new Map([
      ["ST1", "cat1"],
      ["ST2", "cat2"],
      ["Hyper", "cat8"],
      ["Racing", "cat3"],
      ["AGP", "cat4"],
      ["Motocross", "cat5"],
      ["Rally", "cat7"],
      ["Rally/Plane", "cat7"],
      ["RR", "cat6"],
      ["Monster", "cat9"],
      ["Drift", "cat10"], // Drift integriert
    ]);

    let selectedOrder = [];
    let drawExecuted = false;
    let grandraceActive = true;
    let grandraceCategories = [];
    let recentDraws = {}; // üÜï Merkt sich die letzten Fahrzeuge pro Kategorie
    let toastTimer = null;
    let previousMainStage = false;
    window.drawLog = [];
    window.drawRound = 1;
    window.devLoggingEnabled = false;

    function updateGrandraceState(triggeredByClick = false) {
      const grandraceCheckbox = document.getElementById('catGR');
      if (!grandraceCheckbox.checked) {
        if (triggeredByClick && isMainStage) {
        showToast(t("GRcat_mainstage_manual"), "#f44336", 7000);
      }
      return;
    }
    
      const index = getCurrentEventIndex();
      const entry = ROTATION[index];
      const isMainStage = entry[2] === "Main Stage";
    
      // üü• Wenn Main Stage neu erkannt ‚Üí einmaliger Reset
      if (!previousMainStage && isMainStage && grandraceActive) {
        previousMainStage = true;

        ////Grandrace Kategorien zur√ºcksetzten
        //for (let cb of document.querySelectorAll('.catCheckbox')) {
        //  if (cb.id !== 'catGR') {
        //    cb.checked = false;
        //    cb.disabled = false;
        //  }
        //}
        //selectedOrder = [];
        //grandraceCategories = [];
        //updateCheckboxBadges();
        //updateSlotBoxes();
        //updateResetButtonState();
        //updateGoButtonState();

        ////Mainstage Modifikator √ºbernehmen
        // Setze Main Stage Modifikator / reset restl. Filter
        document.getElementById("brandSelect").value = "Ivory-Tower";
        document.getElementById("countrySelect").value = "";
        document.getElementById("eraSelect").value = "";
        updateFilterHighlighting();
    
        showToast(t("GRcat_mainstage_manual"), "#f44336", 7000);
        return;
      }
    
      // ‚úÖ Wenn Main Stage vorbei ist
      if (previousMainStage && !isMainStage) {
        previousMainStage = false;
        showToast(t("GRcat_autoselect_back"), "#0af", 5000);
      }
    
      if (!grandraceActive || isMainStage) return;
    
      const expectedCategories = entry[1].split(" > ");
      const expectedIds = expectedCategories.map(cat => ROTATION_MAP.get(cat));
    
      const selectedIds = Array.from(document.querySelectorAll('.catCheckbox:checked'))
        .map(cb => cb.id)
        .filter(id => id !== "catGR");
    
      expectedIds.sort();
      selectedIds.sort();
    
      if (!arraysEqual(expectedIds, selectedIds) || triggeredByClick) {
        selectedOrder = [];
        for (let cb of document.querySelectorAll('.catCheckbox')) {
          if (cb.id !== 'catGR') {
            cb.checked = false;
            cb.disabled = false;
          }
        }
    
        grandraceCategories = [];
    
        expectedCategories.forEach((cat) => {
          const catBoxId = ROTATION_MAP.get(cat);
          const catCheckBox = document.getElementById(catBoxId);
          if (catCheckBox) {
            catCheckBox.checked = true;
            handleCategoryClick(catCheckBox);
            grandraceCategories.push(catCheckBox);
          }
        });
    
        const currentEventName = entry[0];
        const currentCategories = entry[1].replace(/>/g, "‚Üí");
        showToast(`${t(triggeredByClick ? "rotation_applied_manual" : "rotation_applied_auto")}: ${currentEventName} | ${currentCategories}`, "#39ff14", 10000);
      }
    }

    document.getElementById('catGR').addEventListener('change', (e) => {
      if (!e.target.checked) {
        // Grandrace deaktiviert ‚Üí alles zur√ºcksetzen
        for (let cb of grandraceCategories) {
          cb.checked = false;
          handleCategoryClick(cb);
        }
        grandraceCategories = [];
    
        document.getElementById("brandSelect").value = "";
        document.getElementById("countrySelect").value = "";
        document.getElementById("eraSelect").value = "";
    
        bikeFilterMode = "no_bike";
        const bfb = document.getElementById("bikeFilterBtn");
        bfb.innerText = t("bike_no");
        bfb.classList.add("bike-active");
    
        updateFilterHighlighting();
        updateResetButtonState();
        updateGoButtonState();
    
        showToast(t("GRcat_reset_all"), "#39ff14");
      } else {
        // Aktivierung ‚Üí Rotation setzen
        updateGrandraceState(true);
      }
    });
    
    // Mini-Helfer au√üerhalb der Funktion:
    function arraysEqual(a, b) {
        if (a.length !== b.length) return false;
        for (let i = 0; i < a.length; i++) {
            if (a[i] !== b[i]) return false;
        }
        return true;
    }

    function handleCategoryClick(checkbox) {
      const value = checkbox.value;
    
      // Auswahl verwalten
      if (checkbox.checked) {
        if (!selectedOrder.includes(value)) {
          selectedOrder.push(value);
        }
      } else {
        selectedOrder = selectedOrder.filter(v => v !== value);
      }
    
      updateCheckboxBadges();
    
      // HOVER-Handling je nach Anzahl aktivierter Kategorien (ohne Grandrace)
      const checkedBoxes = Array.from(document.querySelectorAll('.catCheckbox:checked'))
                                .filter(cb => cb.id !== 'catGR');
      const grid = document.querySelector('.category-grid');
    
      if (checkedBoxes.length >= 3) {
        grid.classList.add('limit-reached');
        document.querySelectorAll('.catCheckbox:not(:checked)').forEach(cb => {
          if (cb.id !== 'catGR') cb.disabled = true; // ‚õî Grandrace bleibt aktivierbar
        });
      } else {
        grid.classList.remove('limit-reached');
        document.querySelectorAll('.catCheckbox').forEach(cb => {
          if (cb.id !== 'catGR') cb.disabled = false;
        });
      }
    
      // Slotboxen sofort anzeigen
      updateSlotBoxes();
    
      // Your Pick Titel aktivieren/deaktivieren
      const title = document.getElementById('yourPickTitle');
      if (selectedOrder.length > 0) {
        title.classList.remove('standby');
        title.classList.add('active');
      } else {
        title.classList.remove('active');
        title.classList.add('standby');
      }
    
      updateResetButtonState();
      updateGoButtonState();
    }
    
    function updateCheckboxBadges() {
      const allCheckboxes = document.querySelectorAll('.catCheckbox');
      allCheckboxes.forEach(cb => {
        const label = document.querySelector(`label[for="${cb.id}"]`);
        if (!label) return;
    
        let badge = label.querySelector('.order-badge');
        const index = selectedOrder.indexOf(cb.value);
    
        if (index !== -1) {
          if (!badge) {
            badge = document.createElement("span");
            badge.className = "order-badge";
            label.appendChild(badge);  // ‚úÖ jetzt INS Label!
          }
          badge.innerText = (index + 1).toString();
        } else if (badge) {
          badge.remove();
        }
      });
    }
    function updateSlotBoxes() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';
    
      const title = document.getElementById('yourPickTitle');
      title.classList.remove('active', 'standby');
      title.classList.add(selectedOrder.length === 0 ? 'standby' : 'active');
    
      const categoriesToRender = [...selectedOrder.slice(0, 3)];
        if (categoriesToRender.length === 2) {
          categoriesToRender.push(categoriesToRender[0]); // üß† Dupliziere erste Kategorie als dritte
        } else {
          while (categoriesToRender.length < 3) {
            categoriesToRender.push("");
          }
        }
    
      categoriesToRender.forEach((cat, index) => {
        const isStandby = cat === "";
    
        // Farbklasse bestimmen
        let colorClass = '';
        if (!isStandby) {
          colorClass =
            ['Street Tier 1', 'Street Tier 2', 'Hypercar', 'Drift'].includes(cat) ? 'slot-yellow' :
            ['Racing', 'AGP'].includes(cat) ? 'slot-blue' :
            ['Rally', 'Rally Raid', 'Motocross'].includes(cat) ? 'slot-orange' :
            cat === 'Monster Truck' ? 'slot-magenta' :
            '';
        }
    
        const slot = document.createElement('div');
        slot.classList.add('slot-box');
        if (isStandby) {
          slot.classList.add('empty', 'slot-standby');
        } else {
          slot.classList.add(colorClass);
        }
    
        slot.innerHTML = `
          <div class="slot-badge">${index + 1}</div>
          <div class="slot-category">${isStandby ? "" : cat}</div>
          <div class="slot-name"><span class="question-mark">?</span></div>
          <div class="slot-warning"></div>
        `;
        resultsDiv.appendChild(slot);
      });
    }

    function initializeDropdowns() {
      const brandSelect = document.getElementById("brandSelect");
      if (!brandSelect) return;
    
      const brandRenameMap = {
        'Gordon Murray Automobile': 'Gordan Murray'
      };
    
      const brandSet = new Set(vehicles.map(v => v.brand));
      [...brandSet].sort().forEach(brand => {
        const option = document.createElement("option");
        option.value = brand;
        option.textContent = brandRenameMap[brand] || brand;
        brandSelect.appendChild(option);
      });
    }


    function getCurrentFilters() {
      return {
        brand: document.getElementById("brandSelect").value,
        country: document.getElementById("countrySelect").value,
        era: document.getElementById("eraSelect").value
      };
    }

    function resetSmart() {
      const filters = getCurrentFilters();
      const filtersActive = filters.brand || filters.country || filters.era || selectedOrder.length > 0;
    
      // Zustand 1: Button ist inaktiv ‚Äì keine Funktion
      if (!filtersActive && !drawExecuted) return;
    
      // Zustand 3: Ziehung war aktiv ‚Üí Slotboxen zur√ºcksetzen
      if (drawExecuted) {
        drawExecuted = false;
        updateSlotBoxes();
        updateResetButtonState();
        showToast(t("draw_reset"), "#f44336");
        return;
      }
    
      // Zustand 2: Filter aktiv ‚Üí alles zur√ºcksetzen
      document.getElementById("brandSelect").value = "";
      document.getElementById("countrySelect").value = "";
      document.getElementById("eraSelect").value = "";
    
      bikeFilterMode = "no_bike";
      const bfb = document.getElementById("bikeFilterBtn");
      bfb.innerText = t("bike_no");
      bfb.classList.add("bike-active");
    
      const checkboxes = document.querySelectorAll('.catCheckbox');
      checkboxes.forEach(cb => cb.checked = false);

      const grandraceCheckbox = document.getElementById('catGR');
        if (grandraceCheckbox) {
          grandraceCheckbox.checked = false;
          grandraceCheckbox.dispatchEvent(new Event('change'));
        }
            
      selectedOrder = [];
      updateCheckboxBadges();
      updateFilterHighlighting();
      document.querySelector('.category-grid').classList.remove('limit-reached');
      document.querySelectorAll('.catCheckbox').forEach(cb => cb.disabled = false);
    
      updateSlotBoxes();
      updateResetButtonState();
      updateGoButtonState();
      showToast(t("filters_reset"), "#f44336");
    }
    function updateFilterHighlighting() {
      const brand = document.getElementById("brandSelect");
      const country = document.getElementById("countrySelect");
      const era = document.getElementById("eraSelect");
    
      [brand, country, era].forEach(el => {
        if (el.value !== "") {
          el.classList.add("active");
        } else {
          el.classList.remove("active");
        }
      });
    
      if (!drawExecuted) updateResetButtonState();
    }

    let lastSelection = [];

    function updateResetButtonState() {
      const btn = document.getElementById("resetBtnGrid");
      const filters = getCurrentFilters();
      const filtersActive = filters.brand || filters.country || filters.era || selectedOrder.length > 0;
    
      btn.classList.remove("inactive", "pulsing");
    
      if (!filtersActive && !drawExecuted) {
        btn.classList.add("inactive");
      } else {
        btn.classList.add("pulsing");
      }
    }

    function toggleBikeFilter() {
      const btn = document.getElementById("bikeFilterBtn");
    
      switch (bikeFilterMode) {
        case "no_bike":
          bikeFilterMode = "top_tier";
          btn.innerText = t("top_tier");
          break;
        case "top_tier":
          bikeFilterMode = "bike";
          btn.innerText = t("bike_yes");
          break;
        case "bike":
          bikeFilterMode = "all";
          btn.innerText = t("bike_all");
          break;
        default:
          bikeFilterMode = "no_bike";
          btn.innerText = t("bike_no");
          break;
      }
      // Optionale visuelle Hervorhebung
      // btn.classList.toggle("bike-active", bikeFilterMode !== "all");
    
      if (!drawExecuted) updateResetButtonState();
    }
    
    function updateBrandDropdown() {
      const brandSet = new Set(vehicles.map(v => v.brand));
      const dropdown = document.getElementById("brandSelect");
      [...brandSet].sort().forEach(brand => {
        const opt = document.createElement("option");
        opt.value = brand;
        opt.innerText = brand;
        dropdown.appendChild(opt);
      });
    }
    function drawRandomVehicles() {
      const filters = getCurrentFilters();
      const selectedCategories = Array.from(document.querySelectorAll('.catCheckbox'))
        .filter(cb => cb.checked)
        .map(cb => cb.value);
    
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';
    
      if (selectedCategories.length < 2) {
        resultsDiv.innerHTML = "<p>‚ö†Ô∏è Bitte mindestens 2 Kategorien ausw√§hlen.</p>";
        return;
      }
      if (selectedCategories.length === 2) {
        selectedCategories.push(selectedCategories[0]); // Kategorie 1 duplizieren
      }
    
      const chosen = [];
    
      for (let cat of selectedCategories) {
        const result = drawVehicleForCategory(cat, filters, bikeFilterMode);
        if (!result) continue;
        const { vehicle, ignoredFilters } = result;
        chosen.push({ ...vehicle, ignoredFilters });
      }
    
      if (chosen.length !== 3) {
        resultsDiv.innerHTML = "<p>‚ö†Ô∏è Nicht gen√ºgend Fahrzeuge gefunden.</p>";
        return;
      }
    
      lastSelection = chosen;
      chosen.sort((a, b) => selectedCategories.indexOf(a.category) - selectedCategories.indexOf(b.category));
    
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
      copyToClipboard();
    }

    function repeatDraw() {
      if (!lastSelection || lastSelection.length === 0) {
        fillSlotBoxesWithResults();
        return;
      }
    
      const resultsDiv = document.getElementById('results');
      const slots = resultsDiv.querySelectorAll('.slot-box');
    
      slots.forEach((slot, i) => {
        const v = lastSelection[i];
    
        // Slot optisch aktivieren
        slot.classList.remove('empty');
        slot.classList.remove('slot-yellow', 'slot-blue', 'slot-orange', 'slot-magenta');
    
        const colorClass =
          ['Street Tier 1', 'Street Tier 2', 'Hypercar', 'Drift'].includes(category) ? 'slot-yellow' :
          ['Racing', 'AGP'].includes(category) ? 'slot-blue' :
          ['Rally', 'Rally Raid', 'Motocross'].includes(category) ? 'slot-orange' :
          category === 'Monster Truck' ? 'slot-magenta' :
          '';
    
        // .slot-name gezielt f√ºllen
        const nameDiv = slot.querySelector('.slot-name');
        if (nameDiv) {
          nameDiv.textContent = `${v.brand} ${v.model} (${v.year})`;
        }
    
        // .slot-warning nur f√ºllen, wenn Filter ignoriert wurden
        const warnDiv = slot.querySelector('.slot-warning');
        if (warnDiv) {
          warnDiv.innerHTML = (v.ignoredFilters && v.ignoredFilters.length)
            ? `${t("ignored_filters")} ${v.ignoredFilters.join(", ")}`
            : '';
        }
      });
    
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
      copyToClipboard();
    }
    
    function copyToClipboard(silent = false) {
      if (!lastSelection || lastSelection.length === 0) {
        if (!silent) showToast(t("no_selection_to_copy"));
        return;
      }

      let result = t("clipboard_heading");
    
      lastSelection.forEach(vehicle => {
        result += `|| ${vehicle.category}:\n  ${vehicle.brand} ${vehicle.model} (${vehicle.year})\n\n`;
      });
    
      navigator.clipboard.writeText(result.trim()).then(() => {
        if (!silent) {
          showToast(t("copied"));
        }
      });
    }

    function handleCopy() {
      if (!drawExecuted) return; // keine Aktion im Standby
      copyToClipboard(); // nur wenn kategorien gezogen wurden
    
      const btn = document.getElementById("copyBtn");
      btn.textContent = "üÖí";
      btn.classList.add("clicked");
    
      setTimeout(() => {
        btn.textContent = "‚í∏";
        btn.classList.remove("clicked");
      }, 750); // Dauer halbiert
    }
    
    function fillSlotBoxesWithResults(orderOverride = null) {
      const filters = getCurrentFilters();
      const categories = orderOverride || selectedOrder.slice(0, 3);
    
      if (categories.length < 2) {
        showToast(t("min_two_categories"), "#f33");
        return;
      }
      if (categories.length === 2) {
        categories.push(categories[0]); // Dupliziere erste Kategorie
      }
    
      const chosen = [];
    
      for (let cat of categories) {
        const result = drawVehicleForCategory(cat, filters, bikeFilterMode);
        if (!result) continue;
        const { vehicle, ignoredFilters } = result;
        chosen.push({ ...vehicle, ignoredFilters });
      }
    
      if (chosen.length !== 3) {
        showToast(t("not_enough_cars"), "#f33");
        return;
      }
    
      window.drawRound++;
      localStorage.setItem("zendomizerDrawRound", window.drawRound);
      lastSelection = chosen;
    
      const resultsDiv = document.getElementById('results');
      const slots = resultsDiv.querySelectorAll('.slot-box');
      slots.forEach((slot, i) => {
        const v = chosen[i];
        const nameDiv = slot.querySelector('.slot-name');
        const warnDiv = slot.querySelector('.slot-warning');
    
        nameDiv.textContent = `${v.brand} ${v.model} (${v.year})`;
        warnDiv.innerHTML = v.ignoredFilters.length
          ? `${t("ignored_filters")} ${v.ignoredFilters.join(', ')}`
          : '';
    
        slot.classList.remove('empty', 'slot-yellow', 'slot-blue', 'slot-orange', 'slot-magenta');
    
        const colorClass =
          ['Street Tier 1', 'Street Tier 2', 'Hypercar', 'Drift'].includes(v.category) ? 'slot-yellow' :
          ['Racing', 'AGP'].includes(v.category) ? 'slot-blue' :
          ['Rally', 'Rally Raid', 'Motocross'].includes(v.category) ? 'slot-orange' :
          v.category === 'Monster Truck' ? 'slot-magenta' : '';
    
        slot.classList.add(colorClass);
        slot.classList.add("flash");
        setTimeout(() => slot.classList.remove("flash"), 800);
      });
    
      copyToClipboard();
    }

    function handleGo() {
      if (selectedOrder.length < 2) return;
    
      const SPIN_DURATION = 1800;
      drawExecuted = true;

      updateSlotBoxes(); // üü¢ Slotboxen mit Fragezeichen vorbereiten
    
      const effectiveOrder = [...selectedOrder];
      if (effectiveOrder.length === 2) {
        effectiveOrder.push(effectiveOrder[0]);
      }
    
      const wheel = document.getElementById("wheelOverlay");
      if (wheel) {
        document.documentElement.style.setProperty('--spin-duration', `${SPIN_DURATION}ms`);
        wheel.classList.add("spin");
    
        // F√ºlle Slotboxen parallel zur Drehung: 600ms, 1200ms, 1800ms
        effectiveOrder.forEach((category, index) => {
          setTimeout(() => {
            fillSlotBox(index, category, true); // Jeder Slot einzeln, mit Flash
          }, 600 * (index + 1));
        });
    
        // Drehung nach 1800ms stoppen
        setTimeout(() => {
          wheel.classList.remove("spin");
        }, SPIN_DURATION);
      }
    
      updateResetButtonState();
    
      const btn = document.getElementById("goBtn");
      btn.classList.add("active", "clicked");
      setTimeout(() => btn.classList.remove("active", "clicked"), 750);
    
      if (selectedOrder.length === 2) {
        //showToast(`üîÅ Kategorie 3: <b>${effectiveOrder[2]}</b> wurde wiederholt`, "#ffa500", 6000);
        showToast(t("category_repeated", { category: effectiveOrder[2] }), "#ffa500", 6000);
      }
      setTimeout(() => {
        copyToClipboard();
      }, SPIN_DURATION + 100); // kleiner Sicherheitspuffer
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') drawRandomVehicles();
      if (e.key.toLowerCase() === 'c') copyToClipboard();
    });

    window.onload = () => {
      bikeFilterMode = "no_bike";
      const initialIndex = getCurrentEventIndex();
      const initialEntry = ROTATION[initialIndex];
      previousMainStage = initialEntry[2] === "Main Stage";

      const bfb = document.getElementById("bikeFilterBtn");
      if (bfb) {
        bfb.innerText = t("bike_no");
        bfb.classList.add("bike-active"); // üí° Button gr√ºn gl√ºhen lassen
      }
    
      if (localStorage.getItem('darkmode') === 'true') {
        document.body.classList.add('dark');
      }

      const savedRecentDraws = localStorage.getItem("zendomizerRecentDraws");
      if (savedRecentDraws) {
        try {
          recentDraws = JSON.parse(savedRecentDraws);
          console.log("üì¶ Blacklist aus localStorage geladen.");
        } catch (e) {
          console.warn("‚ö†Ô∏è Fehler beim Parsen von recentDraws:", e);
          recentDraws = {};
        }
      }
      const savedRound = localStorage.getItem("zendomizerDrawRound");
      if (savedRound) {
        window.drawRound = parseInt(savedRound, 10) || 1;
      }
      const savedDrawLog = localStorage.getItem("zendomizerDrawLog");
      if (savedDrawLog) {
        try {
          window.drawLog = JSON.parse(savedDrawLog);
          console.log("üßæ Ziehlog aus localStorage geladen.");
        } catch (e) {
          console.warn("‚ö†Ô∏è Fehler beim Parsen von drawLog:", e);
          window.drawLog = [];
        }
      }

    };
    document.addEventListener('click', function(e) {
      const box = e.target.closest('.slot-box');
      if (!box || !drawExecuted) return;
    
      const category = box.querySelector('.slot-category')?.textContent;
      if (category) {
        rerollSingleSlot(category);
      }
    });

    function clearResults() {
      const boxes = document.querySelectorAll(".slot-box");
      boxes.forEach(box => {
        box.classList.remove("drawn");
        box.querySelector(".slot-name").textContent = "";
        // Wenn du die Kategorie behalten willst, diese Zeile weglassen
        // box.querySelector(".slot-category").textContent = "";
      });
    }
    
    function fillSlotBox(index, category, flash = true) {
      const boxes = document.querySelectorAll(".slot-box");
      if (!boxes[index]) return;
    
      const box = boxes[index];
      const filters = getCurrentFilters();
      const result = drawVehicleForCategory(category, filters, bikeFilterMode);
    
      if (!result) {
        box.querySelector(".slot-category").textContent = category;
        box.querySelector(".slot-name").textContent = "‚ö†Ô∏è kein Fahrzeug";
        box.querySelector(".slot-warning").textContent = t("not_enough_cars");
        box.classList.add("drawn");
        return;
      }
    
      const { vehicle, ignoredFilters } = result;

      lastSelection[index] = {
          brand: vehicle.brand,
          model: vehicle.model,
          year: vehicle.year,
          category: category,
          ignoredFilters: ignoredFilters
      };
    
      // Slot zur√ºcksetzen
      box.classList.remove("empty", "slot-yellow", "slot-blue", "slot-orange", "slot-magenta");
    
      // Farbe bestimmen
      const colorClass =
        ['Street Tier 1', 'Street Tier 2', 'Hypercar', 'Drift'].includes(category) ? 'slot-yellow' :
        ['Racing', 'AGP'].includes(category) ? 'slot-blue' :
        ['Rally', 'Rally Raid', 'Motocross'].includes(category) ? 'slot-orange' :
        category === 'Monster Truck' ? 'slot-magenta' : '';
      if (colorClass) box.classList.add(colorClass);
    
      // Inhalt setzen
      box.querySelector(".slot-category").textContent = category;
      box.querySelector(".slot-name").textContent = `${vehicle.brand} ${vehicle.model} (${vehicle.year})`;
      box.querySelector(".slot-warning").textContent =
        ignoredFilters.length ? `${t("ignored_filters")} ${ignoredFilters.join(", ")}` : "";
    
      box.classList.add("drawn");
    
      if (flash) {
        box.classList.add("flash");
        setTimeout(() => box.classList.remove("flash"), 800);
      }
    }

    
    function updateGoButtonState() {
      const btn = document.getElementById("goBtn");
      btn.classList.remove("inactive", "pulsing"); // üîÅ wichtig: beides entfernen
    
      if (selectedOrder.length < 2) {
        btn.classList.add("inactive");
      } else {
        btn.classList.add("pulsing"); // üü¢ aktiv, wenn 3 Kategorien gew√§hlt
      }
    }
    
    function rerollSingleSlot(category) {
      const filters = getCurrentFilters();
      const result = drawVehicleForCategory(category, filters, bikeFilterMode);
      if (!result) {
        showToast(`${t("no_vehicle_found")}: ${category}`, "#f33");
        return;
      }
    
      const { vehicle, ignoredFilters } = result;
      // Manuell zur Blacklist hinzuf√ºgen, wenn noch nicht enthalten
      if (!recentDraws[category]) {
        recentDraws[category] = [];
      }
      if (!recentDraws[category].some(r =>
        r.brand === vehicle.brand && r.model === vehicle.model && r.year === vehicle.year
      )) {
        recentDraws[category].push(vehicle);
        localStorage.setItem("zendomizerRecentDraws", JSON.stringify(recentDraws));
      }
        
      const index = selectedOrder.indexOf(category);
      if (index === -1) return;
    
      while (lastSelection.length < 3) {
        lastSelection.push(null);
      }
    
      const oldVehicle = lastSelection[index];
    
      lastSelection[index] = { ...vehicle, ignoredFilters };

      window.drawRound++;
      localStorage.setItem("zendomizerDrawRound", window.drawRound);

      const slot = document.querySelectorAll('.slot-box')[index];
      if (!slot) return;
    
      const nameDiv = slot.querySelector('.slot-name');
      const warnDiv = slot.querySelector('.slot-warning');
    
      nameDiv.textContent = `${vehicle.brand} ${vehicle.model} (${vehicle.year})`;
      warnDiv.innerHTML = ignoredFilters.length
        ? `${t("ignored_filters")} ${ignoredFilters.join(', ')}`
        : '';
    
      // ‚ùó Farbanpassung
      slot.classList.remove('empty', 'slot-yellow', 'slot-blue', 'slot-orange', 'slot-magenta');
      const colorClass =
        ['Street Tier 1', 'Street Tier 2', 'Hypercar', 'Drift'].includes(category) ? 'slot-yellow' :
        ['Racing', 'AGP'].includes(category) ? 'slot-blue' :
        ['Rally', 'Rally Raid', 'Motocross'].includes(category) ? 'slot-orange' :
        category === 'Monster Truck' ? 'slot-magenta' :
        '';
      if (colorClass) {
        slot.classList.add(colorClass);
      }
    
      // Flash-Effekt
      slot.classList.add("flash");
      setTimeout(() => slot.classList.remove("flash"), 800);
    
      const isSame = oldVehicle &&
        oldVehicle.brand === vehicle.brand &&
        oldVehicle.model === vehicle.model &&
        oldVehicle.year === vehicle.year;
    
      if (isSame) {
        showToast("üîÅ keine Alternative verf√ºgbar.", "#999");
        copyToClipboard(true);
      } else {
        copyToClipboard();
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function drawVehicleForCategory(category, filters, bikeFilterMode) {
      let ignored = [];
    
      // üîé 1. Grundfilter
      let finalList = vehicles.filter(v =>
        v.category === category &&
        (
          (bikeFilterMode === 'all') ||
          (bikeFilterMode === 'no_bike' && !v.bike) ||
          (bikeFilterMode === 'bike' && v.bike) ||
          (bikeFilterMode === 'top_tier' && v.top_tier === true)
        ) &&
        (!filters.country || v.country === filters.country) &&
        (!filters.era || v.era === filters.era) &&
        (!filters.brand || v.brand === filters.brand)
      );
    
      // üîÅ 2. Fallbacks ‚Äì nacheinander Filter lockern
      if (finalList.length === 0 && bikeFilterMode !== 'all') {
        finalList = vehicles.filter(v =>
          v.category === category &&
          (bikeFilterMode !== 'top_tier' || v.top_tier === true) && // ‚¨ÖÔ∏è wichtig!
          (!filters.country || v.country === filters.country) &&
          (!filters.era || v.era === filters.era) &&
          (!filters.brand || v.brand === filters.brand)
        );
        if (finalList.length > 0) ignored.push("Bike-Filter");
      }
    
      if (finalList.length === 0 && filters.era) {
        finalList = vehicles.filter(v =>
          v.category === category &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
          (!filters.country || v.country === filters.country) &&
          (!filters.brand || v.brand === filters.brand)
        );
        if (finalList.length > 0) ignored.push(`${t("label_era")} (${translateEra(filters.era)})`);
      }
    
      if (finalList.length === 0 && filters.brand) {
        finalList = vehicles.filter(v =>
          v.category === category &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
          (!filters.country || v.country === filters.country) &&
          (!filters.era || v.era === filters.era)
        );
        if (finalList.length > 0) ignored.push(`${t("label_brand")} (${filters.brand})`);
      }
    
      if (finalList.length === 0 && filters.country) {
        finalList = vehicles.filter(v =>
          v.category === category &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
          (!filters.era || v.era === filters.era) &&
          (!filters.brand || v.brand === filters.brand)
        );
        if (finalList.length > 0) ignored.push(`${t("label_country")} (${translateCountry(filters.country)})`);
      }
    
      if (finalList.length === 0) {
        finalList = vehicles.filter(v =>
          v.category === category &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike))
        );
        if (finalList.length > 0) {
          if (filters.era) ignored.push(`${t("label_era")} (${translateEra(filters.era)})`);
          if (filters.brand) ignored.push(`${t("label_brand")} (${filters.brand})`);
          if (filters.country) ignored.push(`${t("label_country")} (${translateCountry(filters.country)})`);
        }
      }
    
      if (finalList.length === 0) {
        finalList = vehicles.filter(v => v.category === category);
        if (finalList.length > 0) ignored.push("Alle Filter");
      }
    
      if (finalList.length === 0) return null; // ‚ùå gar kein Fahrzeug gefunden
    
      // üì¶ Soft-Sperre aktivieren
      if (!recentDraws[category]) {
        recentDraws[category] = [];
      }
      const recent = recentDraws[category];
    
      const availableVehicles = finalList.filter(v =>
        !recent.some(r => r.brand === v.brand && r.model === v.model && r.year === v.year)
      );
    
      const blockedCount = finalList.length - availableVehicles.length;
      const allBlocked = availableVehicles.length === 0;

      // üßπ Wenn alle Fahrzeuge dieser Kategorie gezogen wurden ‚Üí Blacklist zur√ºcksetzen
      if (allBlocked && recent.length === finalList.length) {
        console.log(`üßπ Kategorie: ${category} ‚Äì Blacklist automatisch zur√ºckgesetzt (alle ${recent.length} Fahrzeuge wurden gezogen)`);
        recentDraws[category] = [];
        localStorage.setItem("zendomizerRecentDraws", JSON.stringify(recentDraws));
      
        // üëâ 2) Toast anzeigen
        //showToast(`üßπ Kategorie <b>${category}</b>: Alle Fahrzeuge wurden gezogen ‚Äì Blacklist wurde zur√ºckgesetzt.`, "#ffa500", 7000);
        showToast(t("blacklist_reset_notice", { category }), "#ffa500", 7000);
    
        // üëâ 3) Vermerk im Ziehlog
        window.drawLog.push({
          durchgang: "-",
          category: category,
          selected: "Blacklist zur√ºckgesetzt (Rotation vollst√§ndig)",
          appliedFilters: "-",
          ignoredFilters: "-",
          blockedCount: finalList.length,
          availableCount: finalList.length,
          timestamp: new Date().toLocaleString("de-DE")
        });
        localStorage.setItem("zendomizerDrawLog", JSON.stringify(window.drawLog));
      }
    
      const pool = allBlocked ? finalList : availableVehicles;
      shuffle(pool);
    
      const vehicle = pool[0];
    
      // üîí In Blacklist eintragen (nur wenn noch nicht drin)
      if (!recent.some(r => r.brand === vehicle.brand && r.model === vehicle.model && r.year === vehicle.year)) {
        recent.push(vehicle);
        localStorage.setItem("zendomizerRecentDraws", JSON.stringify(recentDraws));
      }
    
      // üì¢ Konsoleninfo (nur wenn Dev-Logging aktiv)
      if (window.devLoggingEnabled && finalList.length > 0) {
        if (availableVehicles.length > 0) {
          const effectiveChance = (1 / availableVehicles.length * 100).toFixed(2);
          console.log(`üì¶ Kategorie: ${category} | üöó Verf√ºgbar: ${availableVehicles.length} | üö´ Geblockt: ${blockedCount} | üéØ Wahrscheinlichkeit: ${effectiveChance}%`);
        } else {
          console.log(`‚ö†Ô∏è Kategorie: ${category} | üîÅ Alle Fahrzeuge bereits gezogen ‚Äì Wiederholung erlaubt`);
        }
      }

      // Aktive Filter erfassen
      const applied = [];
      if (filters.brand) applied.push(`Marke (${filters.brand})`);
      if (filters.country) applied.push(`Land (${filters.country})`);
      if (filters.era) applied.push(`Zeitraum (${filters.era})`);
      if (bikeFilterMode === "no_bike") applied.push("Cars only");
      else if (bikeFilterMode === "top_tier") applied.push("Top Tier only");
      else if (bikeFilterMode === "bike") applied.push("Bikes only");
      else applied.push("All Vehicles");
    
      // üßæ Ziehung loggen
     window.drawLog.push({
      durchgang: window.drawRound,
      category: category,
      selected: `${vehicle.brand} ${vehicle.model} (${vehicle.year})`,
      appliedFilters: applied.length ? applied.join(", ") : "-",
      ignoredFilters: ignored.length ? "‚ùó " + ignored.join(" | ") : "‚úÖ none",
      blockedCount: blockedCount,
      availableCount: finalList.length,
      timestamp: new Date().toLocaleString("de-DE")
    });
    localStorage.setItem("zendomizerDrawLog", JSON.stringify(window.drawLog));
    return { vehicle, ignoredFilters: ignored };
}

    function updateGrandraceTicker() {
      const tickerContent = document.getElementById('grandraceContent');
      if (!tickerContent) return;
      
      const currentEvent = ROTATION[getCurrentEventIndex()][0];
      
      const spacer = '&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;';
      const message = `üèÅ Ready for <strong class="pulse-glow">${currentEvent}</strong>? Let's race! üèÅ` + (isGrandRaceDay() ? " It's modificator day üèÅ" :
          "");
      
      // Mehrfach Wiederholen, damit der Lauftext lang genug wird
      tickerContent.innerHTML = (message + spacer).repeat(8);
    }
    
    // Direkt beim Laden ausf√ºhren
    window.addEventListener('load', updateGrandraceTicker);
    window.addEventListener('load', () => {
        const grandraceCheckbox = document.getElementById('catGR');
        if (grandraceCheckbox) {
            grandraceCheckbox.checked = true;
            setTimeout(() => {
              updateGrandraceState(true);
            }, 300); // ‚ú® 300ms Verz√∂gerung NUR beim Laden
        }
    });

    
    // Optional: Alle 15 Sekunden neu pr√ºfen
    setInterval(updateGrandraceTicker, 15000);
    
    function showToast(message = "‚úÖ In Zwischenablage kopiert!", color = "#0af", duration = 3000) {
      const toast = document.getElementById("toast");
      if (!toast || !message || message.trim() === "") return; // Keine leeren Toasts
    
      toast.innerHTML = message;
    
      // Fixer schwarzer Hintergrund mit Transparenz
      toast.style.backgroundColor = "rgba(0, 0, 0, 0.75)";
      toast.style.color = color; // Farbiger Text
      toast.style.opacity = 1;
    
      if (window.toastTimer) clearTimeout(window.toastTimer);
      window.toastTimer = setTimeout(() => {
        toast.style.opacity = 0;
        window.toastTimer = null;
      }, duration);
    }
    
    setInterval(() => updateGrandraceState(false), 1000); // alle 1000ms pr√ºfen
    
    const countrySelect = document.getElementById('countrySelect');
    
    countrySelect.addEventListener('change', () => {
      const selectedOption = countrySelect.options[countrySelect.selectedIndex];
    
      // Bei erneutem √ñffnen Dropdown zur√ºcksetzen
      countrySelect.addEventListener('mousedown', () => {
        Array.from(countrySelect.options).forEach(opt => {
          if (opt.getAttribute('data-original')) {
            opt.text = opt.getAttribute('data-original');
          }
        });
      }, { once: true });
    });
    document.addEventListener("keydown", function (e) {
      // SHIFT + ? ‚Üí Hotkey-Legende anzeigen
      if (e.shiftKey && (e.key === '?' || e.key.toLowerCase() === 'h')) {
        showToast(t("hotkey_help"), "#0af", 30000);
      }
      // SHIFT + L ‚Üí Ziehlog anzeigen
      if ((e.shiftKey) && e.key.toLowerCase() === 'l') {
        if (window.drawLog && window.drawLog.length) {
          console.table(window.drawLog);
          showToast("üìã log opened", "#0af");
        } else {
          console.log("‚ÑπÔ∏è log is empty.");
          showToast("‚ÑπÔ∏è log is empty", "#aaa");
        }
      }
      // SHIFT + L ‚Üí Blacklist L√∂schen
      if ((e.shiftKey) && e.key.toLowerCase() === 'r') {
        recentDraws = {};
        localStorage.removeItem("zendomizerRecentDraws");
        // üîÑ Z√§hler zur√ºcksetzen
        window.drawRound = 1;
        localStorage.setItem("zendomizerDrawRound", "1");
        showToast(t("blacklist_cleared"), "#f44336");
        console.log("üßπ reset recentDraws via hotkey.");
        window.drawLog.push({
          durchgang: 'RESET',
          category: '-',
          selected: '-',
          appliedFilters: '-',
          ignoredFilters: '-',
          blockedCount: '-',
          availableCount: '-',
          timestamp: new Date().toLocaleString("de-DE")
        });
        localStorage.setItem("zendomizerDrawLog", JSON.stringify(window.drawLog));
      }
      // SHIFT + X ‚Üí Ziehlog zur√ºcksetzen
      if ((e.shiftKey) && e.key.toLowerCase() === 'x') {
        window.drawLog = [];
        localStorage.removeItem("zendomizerDrawLog");
        showToast(t("drawlog_cleared"), "#f44336");
        console.log("üóëÔ∏è drawLog cleared via hotkey");
      }
      // SHIFT + G ‚Üí Logging aktivieren/deaktivieren
      if (e.shiftKey && e.key.toLowerCase() === 'g') {
        window.devLoggingEnabled = !window.devLoggingEnabled;
        const state = window.devLoggingEnabled ? "activ" : "inactive";
        showToast(`üõ†Ô∏è Dev-Logging ${state}`, window.devLoggingEnabled ? "#0af" : "#aaa");
        console.log(`üõ†Ô∏è Dev-Logging was ${state}`);
      }
    });
  </script>
<div id="toast" class="toast"></div>
</body>
</html>
