<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ZENDOMIZER 1.5 BETA | Fahrzeugliste 06.04.2024</title>
<style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #222;
      color: #0f0;
      padding: 12px 16px;
      border-radus: 8px;
      font-weight: bold;
      font-size: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease-in-out;
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }
    .control-panel {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 12px;
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .filter-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px 16px;
      align-items: center;
      background: transparent;
      padding: 16px;
      border-radius: 12px;
      box-sizing: border-box;
    }
    .filter-wrapper {
      display: flex;
      align-items: stretch;
      gap: 16px;
      padding: 0;         /* Kein horizontaler Innenabstand */
      width: 100%;        /* Wichtig f√ºr volle Breite */
      justify-content: center;
      box-sizing: border-box;
    } 
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      justify-items: center;
      width: 100%;
      max-width: 420px; /* 2 Spalten √† 120px + 1x gap (18px) + 18(test)*/
      margin-bottom: 10px;
    }
    .reset-row {
      display: flex;
      justify-content: flex-end;
      padding: 0 16px;
    }
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 8px;     /* üü¢ h√∂her schieben */
      margin-bottom: 0px;  /* optional: Luft unten */
    }
    /* === NEON-GRUNDSTIL KACHEL === */
    /* === Neon-Badge oben links === */
    .order-badge {
      position: absolute;
      top: 0;
      right: 20px; /* statt right: 4 */
      height: 100%;
      width: 32px; /* etwas breiter statt 24 */
      font-size: 120px;
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: multiply;
      opacity: 0.45;
      color: currentColor;
      text-shadow: /* statt 0 0 2px #000, 0 0 4px #000;*/
          0 0 4px #000,
          0 0 6px currentColor,
          0 0 12px currentColor,
          0 0 18px currentColor,
          0 0 22px currentColor;
    }
    /* Farbvarianten passend zur Kategorie */
    .cat-yellow .order-badge {
      color: #FFD700;
    }
    .cat-blue .order-badge {
      color: #00E5FF;
    }
    .cat-orange .order-badge {
      color: #FF9900;
    }
    .cat-red .order-badge {
      color: #FF4444;
    }
    
    /* Zus√§tzlich: Textfarbe in Kacheln = Rahmenfarbe */
    .catLabel.cat-yellow { color: #FFD700; }
    .catLabel.cat-blue   { color: #00E5FF; }
    .catLabel.cat-orange { color: #FF9900; }
    .catLabel.cat-red    { color: #FF4444; }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      justify-items: center;
      align-items: center;
      max-width: 396px;
    }
    
    .catWrapper {
      position: relative;
      display: block;      /* oder flex */
      width: 120px;
      height: 120px;
    }    
    .catCheckbox {
      display: none;
    }
    .catLabel {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid transparent;
      border-radius: 12px;
      width: 120px;
      height: 120px;
      color: #fff;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      box-sizing: border-box;
      text-shadow: 0 0 2px #000;
      cursor: pointer;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
      position: relative;
      z-index: 2; /* Wichtig: Text liegt √ºber der Badge */
    }
    /* Text in Kategorie Button zentriet (wegen Mehrzeilig) */
    .catLabel span {
      text-align: center;
      line-height: 1.2;
    }
    /* Text lecuhtet wenn Kategorie ausgew√§hlt */
    .catCheckbox:checked + .catLabel {
      box-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor,
        0 0 20px currentColor,
        0 0 28px currentColor;
      animation: none;
    }
    .catCheckbox:checked + .catLabel span {
  color: currentColor;
  font-weight: bold;
  text-shadow:
    0 0 1px currentColor,
    0 0 2px currentColor,
    0 0 4px currentColor;
}
    /* === Neon-Kategorien === */
    
    /* GELB */
    .catLabel.cat-yellow {
      border-color: #FFD700;
      color: #FFD700;
    }
    /* BLAU */
    .catLabel.cat-blue {
      border-color: #00E5FF;
      color: #00E5FF;
    }
    /* ORANGE */
    .catLabel.cat-orange {
      border-color: #FF9900;
      color: #FF9900;
    }
    /* ROT */
    .catLabel.cat-red {
      border-color: #FF4444;
      color: #FF4444;
    }
    @keyframes pulse-neon {
      0%, 100% {
        box-shadow: 0 0 6px currentColor;
        text-shadow: 0 0 2px currentColor;
      }
      50% {
        box-shadow: 0 0 12px currentColor, 0 0 18px currentColor; /* statt 0 0 24px currentColor */
        text-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
      }
    }
    @keyframes pulse-text {
      0%, 100% {
        text-shadow: 0 0 2px currentColor;
      }
      50% {
        text-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
      }
    }
    .category-grid:not(.limit-reached) .catLabel:hover {
      animation: pulse-neon 1.2s infinite;
      border-color: currentColor;
    }
    .category-grid:not(.limit-reached) .catLabel:hover span {
      animation: pulse-text 1.2s infinite;
    }
    .results-panel {
      margin-top: 8px;
      margin-bottom: 64px;
      width: 100%;
      max-width: 100%; /* wichtig: kein limitierendes max-width */
      display: flex;   /* ‚Üê statt block */
      flex-direction: column;
      align-items: center; /* ‚Üê zentriert den inneren #results Block */
    } 
    #results {
      width: 396px;             /* exakt wie eine Slotbox */
      display: flex;            /* statt grid */
      flex-direction: column;
      gap: 48px;
      margin: 0 auto;
    }
        .vehicle {
      background: #111;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px 14px;
      margin-bottom: 10px;
    }
    /* GO-Button (gro√ü & gr√ºn) */
    .start-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      font-size: 20px;
      font-weight: bold;
      text-transform: uppercase;
      border: 2px solid #39ff14;
      color: #39ff14;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* COPY & RESET: 75% der GO-Gr√∂√üe mit leichtem Schleier */
    .copy-btn, .reset-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 26px;
      font-weight: bold;
      color: currentColor;
      background-color: rgba(0, 0, 0, 0.2);
      border: 2px solid currentColor;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Farben individuell */
    .copy-btn {
      color: #0ff; /* cyan */
    }
    
    .reset-btn {
      color: #f33; /* rot */
    }
    
    .start-btn:hover,
    .copy-btn:hover,
    .reset-btn:hover {
      animation: pulse-neon 1.2s infinite;
      background-color: rgba(0, 0, 0, 0.4);
      transform: scale(1.05);
    }
    /* Klick-Effekt */
    .start-btn.clicked,
    .copy-btn.clicked,
    .reset-btn.clicked {
      box-shadow: 0 0 16px currentColor, inset 0 0 12px currentColor;
      transform: scale(1.1);
    }
    #copyNotice {
      color: lime;
      margin-top: 10px;
      display: none;
      font-weight: bold;
    }
.layout {
  display: flex;
  gap: 32px;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
  max-width: 2000px;
  margin: 0 auto;
  padding-top: 90px;
  position: relative;
  z-index: 1;
}

.left-panel,
.right-panel {
  flex: 1 1 40%;
  min-width: 240px;
  max-width: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 0;
  margin: 0;
}
.right-panel {
  position: relative;
}
.center-panel {
  flex: 0 0 20%;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.machine-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 700px;
  background-color: black;
  z-index: 0;
  display: flex;
  justify-content: center;
}
.machine-wrapper::before {
  content: "";
  display: block;
  width: 960px; /* oder deine Wunschbreite */
  height: 700px;
  background: url('https://raw.githubusercontent.com/shogun160/TCM-ZEN_DOMIZER/main/assets/pic/ZENDOMIZER_pic.jpeg') no-repeat center top;
  background-size: contain;
}
.button-top {
  display: flex;
  justify-content: center;
  align-items: flex-end; /* ‚Üê Diese Zeile kommt NEU dazu */
  gap: 24px;
  margin-bottom: 20px;
}
.filter-control {
  background-color: rgba(0, 0, 0, 0.6);
  color: #39ff14;
  border: 2px solid #39ff14;
  border-radius: 12px;
  font-weight: bold;
  font-size: 16px;
  height: 60px;
  padding: 12px 16px;
  box-sizing: border-box;
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
  text-align: left;
  width: 100%;
  max-width: 180px;
}
.filter-control:hover {
  animation: pulse-neon 1.2s infinite;
  border-color: #39ff14;
  color: #39ff14;
  background-color: rgba(0, 0, 0, 0.6); /* gleich wie Grundfarbe */
}
/* Aktiv (‚â† Standardwert) */
.filter-control.active {
  box-shadow:
    0 0 6px #39ff14,
    0 0 12px #39ff14,
    0 0 20px #39ff14;
  color: #39ff14;
  font-weight: bold;
  text-shadow:
    0 0 2px #39ff14,
    0 0 4px #39ff14,
    0 0 8px #39ff14;
}
.filter-control.bike-active {
  box-shadow:
    0 0 6px #39ff14,
    0 0 12px #39ff14,
    0 0 20px #39ff14;
  border-color: #39ff14;
  color: #39ff14;
  font-weight: bold;
  text-shadow:
    0 0 2px #39ff14,
    0 0 4px #39ff14,
    0 0 8px #39ff14;
}
select.filter-control {
  appearance: none;
  background-image: url("data:image/svg+xml;utf8,<svg fill='%23aaa' viewBox='0 0 140 140' xmlns='http://www.w3.org/2000/svg'><polygon points='70,100 100,40 40,40'/></svg>");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 10px;
  padding-right: 32px;
}
@media (max-width: 1068px) {
  .layout {
    flex-direction: column;
    align-items: stretch;
  }

  .left-panel,
  .center-panel,
  .right-panel {
    max-width: 100%;
    flex: none;
  }

  .button-top {
    justify-content: center;
  }
}
@media (min-width: 1069px) {
  .center-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;   /* Buttons nach unten dr√ºcken */
    height: 600px;               /* passend zur Automatenh√∂he */
  }

  .button-top {
    margin-top: auto;
    margin-bottom: 20px;         /* Abstand vom unteren Rand */
  }
}
/* --- SLOTBOXEN (rechter Bereich) --- */
.slot-box {
  width: 396px;
  height: 120px;
  position: relative;
  background: rgba(0, 0, 0, 0.6);
  border: 3px solid currentColor;
  border-radius: 16px;
  padding: 12px;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
  color: currentColor;
  box-shadow: 0 0 12px currentColor;
  transition: all 0.3s ease-in-out;
  display: grid;
  grid-template-rows: 24px 80px 18px; /* ‚Üê definierte H√∂hen */
  align-items: center;
  justify-items: center;
  animation: pulse-neon 2s infinite;
}
.slot-category {
  font-size: 16px;
  font-weight: bold;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.slot-name {
  font-size: 20px;
  font-weight: bold;
  text-shadow:
    0 0 2px currentColor,
    0 0 6px currentColor,
    0 0 12px currentColor;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  text-align: center;
  word-break: break-word;
}
.slot-box.empty .slot-name {
  font-size: 80px;
  animation: spin3D 1.6s linear infinite, pulse-text 1.2s infinite;
  transform-style: preserve-3d;
  backface-visibility: hidden;
}
.slot-box.empty {
  perspective: 600px;
}
@keyframes spin3D {
  from { transform: rotateY(0deg); }
  to { transform: rotateY(360deg); }
}
.slot-warning {
  font-size: 12px;
  opacity: 0.4;
  color: rgba(255, 255, 255, 0.4);
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  justify-content: center;
}
.slot-warning:empty::before {
  content: none;
}
.slot-badge {
  position: absolute;
  right: 28px;
  top: 0;
  height: 100%;
  width: 46px;
  font-size: 180px;
  font-weight: 900;
  color: currentColor;
  display: flex;
  align-items: center;
  justify-content: center;
  text-shadow:
    0 0 4px #000,
    0 0 6px currentColor,
    0 0 12px currentColor,
    0 0 20px currentColor;
  opacity: 0.4;
  pointer-events: none;
  mix-blend-mode: screen;
}
.your-pick-title {
  font-size: 36px;
  margin: 0 0 16px 0;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
  transition: all 0.4s ease-in-out;
  letter-spacing: 1px;
  max-width: 396px;
  margin-left: auto;
  margin-right: auto;
}

.your-pick-title.inactive {
  color: #222;
  opacity: 0.3;
  text-shadow:
    0 0 4px #000,
    0 0 8px #111;
}
.your-pick-title.active {
  color: #ff00ff;
  opacity: 1;
  text-shadow:
    0 0 2px #ff00ff,
    0 0 6px #ff00ff,
    0 0 12px #ff00ff,
    0 0 20px #ff00ff;
}
/* Farbliche Kategorien f√ºr Slot-Boxen */
.slot-yellow { color: #FFD700; }
.slot-blue   { color: #00E5FF; }
.slot-orange { color: #FF9900; }
.slot-red    { color: #FF4444; }

</style>
</head>
<body>
<div class="machine-wrapper"></div>
<div class="layout"><div class="left-panel">
<div class="filter-wrapper">
  <div class="filter-grid">
      <button id="bikeFilterBtn" class="filter-control" onclick="toggleBikeFilter()">loading...</button>
      <select id="countrySelect" class="filter-control" onchange="updateFilterHighlighting()">
        <option value="">Land w√§hlen</option>
      </select>
      <select id="brandSelect" class="filter-control" onchange="updateFilterHighlighting()">
        <option value="">Marke w√§hlen</option>
      </select>
      <select id="eraSelect" class="filter-control" onchange="updateFilterHighlighting()">
        <option value="">Zeitraum w√§hlen</option>
      </select>
    </div>
</div>
    <div class="category-grid">
      <div class="catWrapper">
        <input type="checkbox" id="cat1" class="catCheckbox" onchange="handleCategoryClick(this)" value="Street Tier 1" />
        <label for="cat1" class="catLabel cat-yellow"><span>Street<br>Tier 1</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat2" class="catCheckbox" onchange="handleCategoryClick(this)" value="Street Tier 2" />
        <label for="cat2" class="catLabel cat-yellow"><span>Street<br>Tier 2</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat8" class="catCheckbox" onchange="handleCategoryClick(this)" value="Hypercar" />
        <label for="cat8" class="catLabel cat-yellow"><span>Hypercar</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat3" class="catCheckbox" onchange="handleCategoryClick(this)" value="Rally" />
        <label for="cat3" class="catLabel cat-blue"><span>Rally</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat4" class="catCheckbox" onchange="handleCategoryClick(this)" value="Rally Raid" />
        <label for="cat4" class="catLabel cat-blue"><span>Rally Raid</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat5" class="catCheckbox" onchange="handleCategoryClick(this)" value="Motocross" />
        <label for="cat5" class="catLabel cat-blue"><span>Motocross</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat7" class="catCheckbox" onchange="handleCategoryClick(this)" value="AGP" />
        <label for="cat7" class="catLabel cat-orange"><span>AGP</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat6" class="catCheckbox" onchange="handleCategoryClick(this)" value="Racing" />
        <label for="cat6" class="catLabel cat-orange"><span>Racing</span></label>
      </div>
      <div class="catWrapper">
        <input type="checkbox" id="cat9" class="catCheckbox" onchange="handleCategoryClick(this)" value="Monster Truck" />
        <label for="cat9" class="catLabel cat-red"><span>Monster Truck</span></label>
      </div>
    </div>
    </div>
        <div class="center-panel">
          <div class="button-top">
            <button id="resetBtn" class="reset-btn" onclick="resetFilters()">R</button>
            <button id="copyBtn" class="copy-btn" onclick="handleCopy()">‚í∏</button>
            <button id="goBtn" class="start-btn" onclick="handleGo()">GO</button>
          </div>
        </div>
    <div class="right-panel">
        <div class="results-panel">
          <h2 id="yourPickTitle" class="your-pick-title inactive">Your Pick</h2>
          <div id="results"></div>
        </div>
    </div>
</div>
<script src="https://shogun160.github.io/TCM-ZEN_DOMIZER/cars/vehicles.json" type="application/json"></script>
<script>
    let selectedOrder = [];

    function handleCategoryClick(checkbox) {
      const value = checkbox.value;
    
      // Auswahl verwalten
      if (checkbox.checked) {
        if (!selectedOrder.includes(value)) {
          selectedOrder.push(value);
        }
      } else {
        selectedOrder = selectedOrder.filter(v => v !== value);
      }
    
      // Checkbox-Badges aktualisieren (dein vorhandener Call)
      updateCheckboxBadges();
    
      // HOVER-Handling je nach Anzahl aktivierter Kategorien
      const checkedBoxes = document.querySelectorAll('.catCheckbox:checked');
      const grid = document.querySelector('.category-grid');
    
      if (checkedBoxes.length >= 3) {
        grid.classList.add('limit-reached');
        document.querySelectorAll('.catCheckbox:not(:checked)').forEach(cb => cb.disabled = true);
      } else {
        grid.classList.remove('limit-reached');
        document.querySelectorAll('.catCheckbox').forEach(cb => cb.disabled = false);
      }
      // Slotboxen sofort anzeigen
      updateSlotBoxes();
      // Your Pick Titel aktivieren/deaktivieren
      const title = document.getElementById('yourPickTitle');
      if (selectedOrder.length > 0) {
        title.classList.remove('inactive');
        title.classList.add('active');
      } else {
        title.classList.remove('active');
        title.classList.add('inactive');
      }
    }
    function updateCheckboxBadges() {
      const allCheckboxes = document.querySelectorAll('.catCheckbox');
      allCheckboxes.forEach(cb => {
        const label = document.querySelector(`label[for="${cb.id}"]`);
        if (!label) return;
    
        let badge = label.querySelector('.order-badge');
        const index = selectedOrder.indexOf(cb.value);
    
        if (index !== -1) {
          if (!badge) {
            badge = document.createElement("span");
            badge.className = "order-badge";
            label.appendChild(badge);  // ‚úÖ jetzt INS Label!
          }
          badge.innerText = (index + 1).toString();
        } else if (badge) {
          badge.remove();
        }
      });
    }
    function updateSlotBoxes() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';
    
      selectedOrder.slice(0, 3).forEach((cat, index) => {
        const colorClass =
          cat.includes('Street') || cat === 'Hypercar' ? 'slot-yellow' :
          ['Rally', 'Rally Raid', 'Motocross'].includes(cat) ? 'slot-blue' :
          ['Racing', 'AGP'].includes(cat) ? 'slot-orange' :
          cat === 'Monster Truck' ? 'slot-red' : '';
    
        const slot = document.createElement('div');
        slot.className = `slot-box empty ${colorClass}`;
        slot.innerHTML = `
          <div class="slot-badge">${index + 1}</div>
          <div class="slot-category">${cat}</div>
          <div class="slot-name"><span class="question-mark">?</span></div>
          <div class="slot-warning"></div>
        `;
        resultsDiv.appendChild(slot);
      });
    }
    function initializeDropdowns() {
      const brandSelect = document.getElementById("brandSelect");
      const countrySelect = document.getElementById("countrySelect");
      const eraSelect = document.getElementById("eraSelect");
    
      const brandRenameMap = {
        'Gordon Murray Automobile': 'Gordan Murray'
      };
    
      const countryRenameMap = {
        'Vereinigte Arabische Emirate': 'Arabische Emirate'
      };
    
      const brandSet = new Set(vehicles.map(v => v.brand));
      [...brandSet].sort().forEach(brand => {
        const option = document.createElement("option");
        option.value = brand;
        option.textContent = brandRenameMap[brand] || brand;
        brandSelect.appendChild(option);
      });
    
      const countrySet = new Set(vehicles.map(v => v.country));
      [...countrySet].sort().forEach(country => {
        const option = document.createElement("option");
        option.value = country;
        option.textContent = countryRenameMap[country] || country;
        countrySelect.appendChild(option);
      });
    
      const eraSet = new Set(vehicles.map(v => v.era));
      [...eraSet].sort().forEach(era => {
        const option = document.createElement("option");
        option.value = era;
        option.textContent = era;
        eraSelect.appendChild(option);
      });
    }
    function getCurrentFilters() {
      return {
        brand: document.getElementById("brandSelect").value,
        country: document.getElementById("countrySelect").value,
        era: document.getElementById("eraSelect").value
      };
    }

    function resetFilters() {
      document.getElementById("brandSelect").value = "";
      document.getElementById("countrySelect").value = "";
      document.getElementById("eraSelect").value = "";
    
      const btn = document.getElementById("resetBtn");
      btn.classList.add("clicked");
      setTimeout(() => btn.classList.remove("clicked"), 500);
    
      showToast("‚ü≤ Auswahl wurde zur√ºckgesetzt!", "#f44336");
    
      updateFilterHighlighting();
    
      // Bike-Filter zur√ºcksetzen
      bikeFilterMode = "no_bike";
      const bfb = document.getElementById("bikeFilterBtn");
      bfb.innerText = "Nur Autos";
      bfb.classList.add("bike-active");
    
      // Kategorie-Checkboxen deaktivieren
      const checkboxes = document.querySelectorAll('.catCheckbox');
      checkboxes.forEach(cb => cb.checked = false);
    
      // Auswahl-Tracking & Badge-Anzeige zur√ºcksetzen
      selectedOrder = [];
      updateCheckboxBadges();
    
      // Limit-Status entfernen
      document.querySelector('.category-grid').classList.remove('limit-reached');
      document.querySelectorAll('.catCheckbox').forEach(cb => cb.disabled = false);
      // Ergebnis Slot-Boxen
      document.getElementById('results').innerHTML = '';
      // Your Pick √úberschrift active / inactive
      document.getElementById('yourPickTitle').classList.remove('active');
      document.getElementById('yourPickTitle').classList.add('inactive');
    }
    function updateFilterHighlighting() {
      const brand = document.getElementById("brandSelect");
      const country = document.getElementById("countrySelect");
      const era = document.getElementById("eraSelect");
    
      [brand, country, era].forEach(el => {
        if (el.value !== "") {
          el.classList.add("active");
        } else {
          el.classList.remove("active");
        }
      });
    }

    let lastSelection = [];

    function toggleBikeFilter() {
      const btn = document.getElementById("bikeFilterBtn");
      if (bikeFilterMode === 'no_bike') {
        bikeFilterMode = 'bike';
        btn.innerText = "Nur Bikes";
        btn.classList.add("bike-active");
      } else if (bikeFilterMode === 'bike') {
        bikeFilterMode = 'all';
        btn.innerText = "Alle Fahrzeuge";
        btn.classList.remove("bike-active");
      } else {
        bikeFilterMode = 'no_bike';
        btn.innerText = "Nur Autos";
        btn.classList.add("bike-active");
      }
    }
    function updateBrandDropdown() {
      const brandSet = new Set(vehicles.map(v => v.brand));
      const dropdown = document.getElementById("brandSelect");
      [...brandSet].sort().forEach(brand => {
        const opt = document.createElement("option");
        opt.value = brand;
        opt.innerText = brand;
        dropdown.appendChild(opt);
      });
    }
    function drawRandomVehicles() {
      const filters = getCurrentFilters();
      const selectedCategories = Array.from(document.querySelectorAll('.catCheckbox'))
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      const selectedBrand = filters.brand;

      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      if (selectedCategories.length < 3) {
        resultsDiv.innerHTML = "<p>‚ö†Ô∏è Bitte 3 Kategorien ausw√§hlen.</p>";
        return;
      }

      const shuffledCategories = selectedCategories.sort(() => 0.5 - Math.random()).slice(0, 3);
      const chosen = [];

      for (let cat of shuffledCategories) {
        
        let ignored = [];

        let finalList = [];

        // Schritt 1: Alle aktiven Filter
        finalList = vehicles.filter(v =>
          v.category === cat &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && v.bike === false) || (bikeFilterMode === 'bike' && v.bike === true)) &&
          (!filters.country || v.country === filters.country) &&
          (!filters.era || v.era === filters.era) &&
          (!filters.brand || v.brand === filters.brand)
        );

        if (finalList.length === 0) {
          // Schritt 2: Bike-Filter ignorieren (nur wenn aktiv)
          if (bikeFilterMode === 'no_bike' || bikeFilterMode === 'bike') {
            const fallback = vehicles.filter(v =>
              v.category === cat &&
              (!filters.country || v.country === filters.country) &&
              (!filters.era || v.era === filters.era) &&
              (!filters.brand || v.brand === filters.brand)
            );
            if (fallback.length > 0) {
              finalList = fallback;
              ignored.push(bikeFilterMode === 'no_bike' ? 'Nur Autos' : 'Nur Bikes');
            }
          }
        }

        // Schritt 3‚Äì5: Einzelne Filter ignorieren (nur wenn aktiv)
        if (finalList.length === 0 && filters.era) {
          const fallback = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && v.bike === false) || (bikeFilterMode === 'bike' && v.bike === true)) &&
            (!filters.country || v.country === filters.country) &&
            (!filters.brand || v.brand === filters.brand)
          );
          if (fallback.length > 0) {
            finalList = fallback;
            ignored.push(`Zeitraum (${filters.era})`);
          }
        }

        if (finalList.length === 0 && filters.brand) {
          const fallback = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && v.bike === false) || (bikeFilterMode === 'bike' && v.bike === true)) &&
            (!filters.country || v.country === filters.country) &&
            (!filters.era || v.era === filters.era)
          );
          if (fallback.length > 0) {
            finalList = fallback;
            ignored.push(`Marke (${filters.brand})`);
          }
        }

        if (finalList.length === 0 && filters.country) {
          const fallback = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && v.bike === false) || (bikeFilterMode === 'bike' && v.bike === true)) &&
            (!filters.era || v.era === filters.era) &&
            (!filters.brand || v.brand === filters.brand)
          );
          if (fallback.length > 0) {
            finalList = fallback;
            ignored.push(`Land (${filters.country})`);
          }
        }

        // Schritt 6: Alle au√üer Kategorie & Bike-Filter ignorieren
        if (finalList.length === 0) {
          const fallback = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && v.bike === false) || (bikeFilterMode === 'bike' && v.bike === true))
          );
          if (fallback.length > 0) {
            finalList = fallback;
            if (filters.era) ignored.push(`Zeitraum (${filters.era})`);
            if (filters.brand) ignored.push(`Marke (${filters.brand})`);
            if (filters.country) ignored.push(`Land (${filters.country})`);
          }
        }

        // Schritt 7: Alles ignorieren au√üer Kategorie
        if (finalList.length === 0) {
          const fallback = vehicles.filter(v => v.category === cat);
          if (fallback.length > 0) {
            finalList = fallback;
            ignored.push('Alle');
          }
        }

        if (finalList.length === 0) continue;

        const vehicle = finalList[Math.floor(Math.random() * finalList.length)];
        chosen.push({...vehicle, ignoredFilters: ignored});
      }

      if (chosen.length !== 3) {
        resultsDiv.innerHTML = "<p>‚ö†Ô∏è Nicht gen√ºgend Fahrzeuge gefunden.</p>";
        return;
      }

      chosen.sort((a, b) => selectedOrder.indexOf(a.category) - selectedOrder.indexOf(b.category));

      lastSelection = chosen;

      resultsDiv.scrollIntoView({ behavior: 'smooth' });
      copyToClipboard();
    }

    function repeatDraw() {
      if (!lastSelection || lastSelection.length === 0) {
        fillSlotBoxesWithResults();
        return;
      }
    
      const resultsDiv = document.getElementById('results');
      const slots = resultsDiv.querySelectorAll('.slot-box');
    
      slots.forEach((slot, i) => {
        const v = lastSelection[i];
    
        // Slot optisch aktivieren
        slot.classList.remove('empty');
        slot.classList.remove('slot-yellow', 'slot-blue', 'slot-orange', 'slot-red');
    
        const colorClass =
          v.category.includes('Street') || v.category === 'Hypercar' ? 'slot-yellow' :
          ['Rally', 'Rally Raid', 'Motocross'].includes(v.category) ? 'slot-blue' :
          ['Racing', 'AGP'].includes(v.category) ? 'slot-orange' :
          v.category === 'Monster Truck' ? 'slot-red' : '';
        slot.classList.add(colorClass);
    
        // .slot-name gezielt f√ºllen
        const nameDiv = slot.querySelector('.slot-name');
        if (nameDiv) {
          nameDiv.textContent = `${v.brand} ${v.model} (${v.year})`;
        }
    
        // .slot-warning nur f√ºllen, wenn Filter ignoriert wurden
        const warnDiv = slot.querySelector('.slot-warning');
        if (warnDiv) {
          warnDiv.innerHTML = v.ignoredFilters?.length
            ? `Ignorierte Filter: ${v.ignoredFilters.join(', ')}`
            : '';
        }
      });
    
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
      copyToClipboard();
    }
    function copyToClipboard() {
      if (!lastSelection || lastSelection.length === 0) {
        showToast("‚ö†Ô∏è Keine Auswahl zum Kopieren.");
        return;
      }
    
      let result = "üé≤ ZENDOMIZER Auswahl:\n\n";
    
      lastSelection.forEach(vehicle => {
        result += `|| ${vehicle.category}:\n  ${vehicle.brand} ${vehicle.model} (${vehicle.year})\n\n`;
      });
    
      navigator.clipboard.writeText(result.trim()).then(() => {
        showToast("‚úÖ In Zwischenablage kopiert!");
      });
    }
    function handleCopy() {
      copyToClipboard(); // bestehende Funktion
    
      const btn = document.getElementById("copyBtn");
      btn.textContent = "üÖí";
      btn.classList.add("clicked");
    
      setTimeout(() => {
        btn.textContent = "‚í∏";
        btn.classList.remove("clicked");
      }, 750); // Dauer halbiert
    }
    function fillSlotBoxesWithResults() {
      const filters = getCurrentFilters();
      const selectedCategories = selectedOrder.slice(0, 3);
    
      if (selectedCategories.length < 3) {
        showToast("‚ö†Ô∏è Bitte 3 Kategorien ausw√§hlen.", "#f33");
        return;
      }
    
      const shuffled = [...selectedCategories];
      const chosen = [];
    
      for (let cat of shuffled) {
        let ignored = [];
        let finalList = [];
    
        finalList = vehicles.filter(v =>
          v.category === cat &&
          (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
          (!filters.country || v.country === filters.country) &&
          (!filters.era || v.era === filters.era) &&
          (!filters.brand || v.brand === filters.brand)
        );
    
        if (finalList.length === 0 && bikeFilterMode !== 'all') {
          finalList = vehicles.filter(v =>
            v.category === cat &&
            (!filters.country || v.country === filters.country) &&
            (!filters.era || v.era === filters.era) &&
            (!filters.brand || v.brand === filters.brand)
          );
          if (finalList.length > 0) ignored.push("Bike-Filter");
        }
    
        if (finalList.length === 0 && filters.era) {
          finalList = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
            (!filters.country || v.country === filters.country) &&
            (!filters.brand || v.brand === filters.brand)
          );
          if (finalList.length > 0) ignored.push("Zeitraum");
        }
    
        if (finalList.length === 0 && filters.brand) {
          finalList = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
            (!filters.country || v.country === filters.country) &&
            (!filters.era || v.era === filters.era)
          );
          if (finalList.length > 0) ignored.push("Marke");
        }
    
        if (finalList.length === 0 && filters.country) {
          finalList = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike)) &&
            (!filters.era || v.era === filters.era) &&
            (!filters.brand || v.brand === filters.brand)
          );
          if (finalList.length > 0) ignored.push("Land");
        }
    
        if (finalList.length === 0) {
          finalList = vehicles.filter(v =>
            v.category === cat &&
            (bikeFilterMode === 'all' || (bikeFilterMode === 'no_bike' && !v.bike) || (bikeFilterMode === 'bike' && v.bike))
          );
          if (filters.era) ignored.push("Zeitraum");
          if (filters.brand) ignored.push("Marke");
          if (filters.country) ignored.push("Land");
        }
    
        if (finalList.length === 0) {
          finalList = vehicles.filter(v => v.category === cat);
          ignored.push("Bike-Filter", "Land", "Marke", "Zeitraum");
        }
    
        if (finalList.length === 0) continue;
    
        const vehicle = finalList[Math.floor(Math.random() * finalList.length)];
        chosen.push({ ...vehicle, ignoredFilters: [...new Set(ignored)] });
      }
    
      if (chosen.length !== 3) {
        showToast("‚ö†Ô∏è Nicht gen√ºgend Fahrzeuge gefunden.", "#f33");
        return;
      }
    
      lastSelection = chosen;
    
      const resultsDiv = document.getElementById('results');
      const slots = resultsDiv.querySelectorAll('.slot-box');
      slots.forEach((slot, i) => {
        const v = chosen[i];
        const nameDiv = slot.querySelector('.slot-name');
        const warnDiv = slot.querySelector('.slot-warning');
    
        // Update Inhalt gezielt
        if (nameDiv) {
          nameDiv.textContent = `${v.brand} ${v.model} (${v.year})`;
        }
        if (warnDiv) {
          warnDiv.innerHTML = v.ignoredFilters?.length
            ? `Ignorierte Filter: ${v.ignoredFilters.join(', ')}`
            : '';
        }
    
        // Styling aktualisieren
        slot.classList.remove('empty');
        slot.classList.remove('slot-yellow', 'slot-blue', 'slot-orange', 'slot-red');
    
        const colorClass =
          v.category.includes('Street') || v.category === 'Hypercar' ? 'slot-yellow' :
          ['Rally', 'Rally Raid', 'Motocross'].includes(v.category) ? 'slot-blue' :
          ['Racing', 'AGP'].includes(v.category) ? 'slot-orange' :
          v.category === 'Monster Truck' ? 'slot-red' : '';
        slot.classList.add(colorClass);
      });
    
      copyToClipboard();
    }
    function handleGo() {
      fillSlotBoxesWithResults(); // Neue Funktion: bef√ºllt vorhandene Slotboxen
    
      const btn = document.getElementById("goBtn");
      btn.classList.add("active");
      btn.classList.add("clicked");
    
      setTimeout(() => {
        btn.classList.remove("active");
        btn.classList.remove("clicked");
      }, 750); // Dauer halbiert
    }
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') drawRandomVehicles();
      if (e.key.toLowerCase() === 'r') repeatDraw();
      if (e.key.toLowerCase() === 'c') copyToClipboard();
    });

    window.onload = () => {
      bikeFilterMode = "no_bike";
    
      const bfb = document.getElementById("bikeFilterBtn");
      if (bfb) {
        bfb.innerText = "Nur Autos";
        bfb.classList.add("bike-active"); // üí° Button gr√ºn gl√ºhen lassen
      }
    
      if (localStorage.getItem('darkmode') === 'true') {
        document.body.classList.add('dark');
      }
    
      fetch('cars/vehicles.json')
        .then(response => response.json())
        .then(data => {
          vehicles = data;
          initializeDropdowns();
        })
        .catch(err => {
          console.error("üö® Fehler beim Laden von vehicles.json:", err);
          alert("‚ö†Ô∏è Fahrzeugdaten konnten nicht geladen werden.");
        });
    };
    function showToast(message = "‚úÖ In Zwischenablage kopiert!", color = "#0f0") {
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.style.color = color;
      toast.classList.add("show");
    
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }
    const countrySelect = document.getElementById('countrySelect');
    
    countrySelect.addEventListener('change', () => {
      const selectedOption = countrySelect.options[countrySelect.selectedIndex];
    
      if (selectedOption.text === 'Vereinigte Arabische Emirate') {
        selectedOption.text = 'Arabische Emirate';
        selectedOption.setAttribute('data-original', 'Vereinigte Arabische Emirate');
      }
    
      // Bei erneutem √ñffnen Dropdown zur√ºcksetzen
      countrySelect.addEventListener('mousedown', () => {
        Array.from(countrySelect.options).forEach(opt => {
          if (opt.getAttribute('data-original')) {
            opt.text = opt.getAttribute('data-original');
          }
        });
      }, { once: true });
    });
  </script>
<div id="toast" class="toast">‚úÖ In Zwischenablage kopiert!</div>
</body>
</html>
